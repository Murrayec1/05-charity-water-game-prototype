<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Responsive viewport for mobile and tablet -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="An educational game about the daily journey many girls take to collect water, inspired by charity: water's mission.">
  <meta name="keywords" content="water crisis, education, charity water, social impact, interactive game">
  <title>The Long Walk: A Journey for Water</title>
  <style>
    /* Skip navigation link for accessibility */
    .skip-link {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
      z-index: 9999;
      background: #2E9DF7;
      color: #fff;
      padding: 10px;
      text-decoration: none;
      font-weight: bold;
    }
    
    .skip-link:focus {
      left: 10px;
      top: 10px;
      width: auto;
      height: auto;
      overflow: visible;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f4f4f4, #e8f4f8);
      color: #111;
      font-weight: bold;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px 20px 60px 20px; /* Add bottom padding for footer */
    }

    #gameContainer {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      position: relative;
      overflow: hidden;
      /* We'll set background images from JavaScript */
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s;
      color: #111; /* Ensure text is very dark on white */
      font-weight: bold; /* Bolder text */
      padding-bottom: 0; /* Remove extra space at bottom */
      /* Removed border for better mobile visibility */
    }

    h1 {
      color: #00263a; /* Dark blue for excellent contrast on white */
      font-size: 2rem;
      text-align: center;
      font-weight: bold;
      letter-spacing: 1px;
      margin-bottom: 15px;
    }

    #storyText {
      font-size: 1.2rem;
      margin: 20px 0;
      color: #111; /* Very dark text */
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
      background: rgba(255,255,255,0.65); /* More transparent background */
      backdrop-filter: blur(3px); /* Add blur effect */
      border-radius: 6px;
      padding: 10px 12px;
      box-sizing: border-box;
      border: 1px solid rgba(44,157,247,0.2); /* Subtle border */
    }

    #choices {
      display: flex; /* Use flexbox to center options */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin: 0 auto;
    }

    .choiceBtn {
      display: block;
      background-color: #2E9DF7; /* charity: water blue */
      color: #fff;
      border: none; /* Removed border for cleaner mobile look */
      padding: 12px;
      margin: 10px 0;
      width: 100%;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(46, 157, 247, 0.3);
      margin-left: auto;
      margin-right: auto;
      text-decoration: none;
    }

    .choiceBtn:focus {
      outline: 4px solid #FFC907;
      outline-offset: 3px;
      box-shadow: 0 0 0 2px #fff, 0 0 0 6px #FFC907;
    }

    .choiceBtn:hover {
      background-color: #FFC907; /* charity: water yellow on hover */
      color: #00263a; /* dark text on yellow background */
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 201, 7, 0.4);
    }

    /* Ensure keyboard navigation visibility */
    .choiceBtn:focus-visible {
      outline: 4px solid #FFC907;
      outline-offset: 3px;
    }

    #statusBar {
      margin-top: 20px;
      font-size: 1rem;
      color: #00263a;
      background: rgba(255, 201, 7, 0.75); /* More transparent background */
      backdrop-filter: blur(3px); /* Add blur effect */
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(255, 201, 7, 0.3);
      border: 1px solid rgba(255, 201, 7, 0.4); /* Subtle border */
    }

    /* Score area with charity: water branding */
    #scoreArea {
      background: rgba(255, 201, 7, 0.75); /* More transparent background */
      backdrop-filter: blur(3px); /* Add blur effect */
      color: #00263a;
      border-radius: 6px;
      padding: 8px 12px;
      margin-bottom: 8px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(255, 201, 7, 0.3);
      border: 1px solid rgba(255, 201, 7, 0.4); /* Subtle border */
    }

    /* Character styles */
    #characterContainer {
      position: absolute; /* Place the character exactly over the map line */
      margin-bottom: 0;
      left: 0; /* Will be set by JS */
      top: 0;  /* Will be set by JS */
      width: 40px;
      height: 75px;
      pointer-events: none;
      z-index: 10; /* Above the SVG path */
      transition: left 0.7s, top 0.7s;
    }
    #characterSprite {
      width: 100%;
      height: auto;
      display: block;
    }
    #jerryCanIcon {
      position: absolute;
      right: 8px;
      bottom: 18px;
      width: 26px;
      height: 26px;
      z-index: 3;
    }

    /* Landing page overlay styles */
    #landingPage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #fff; /* Solid white for best contrast */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* Changed from center to flex-start */
      z-index: 10;
      color: #111;
      font-weight: bold;
      overflow-y: auto; /* Allow scrolling if content is too tall */
      padding: 20px 15px 40px 15px; /* Add padding to ensure content isn't cut off */
      box-sizing: border-box;
    }
    #landingTitle {
      font-size: 2.2rem;
      color: #00263a !important; /* Dark blue for better contrast - important to override h1 styles */
      text-shadow: none !important; /* Remove white text shadow that blends with background */
      margin-bottom: 10px;
      text-align: center;
      font-weight: bold;
      background: none !important; /* Remove any gradient background */
      -webkit-background-clip: initial !important; /* Reset background clip */
      background-clip: initial !important; /* Reset background clip */
      -webkit-text-fill-color: #00263a !important; /* Ensure solid color text */
    }
    #landingSubtitle {
      font-size: 1.1rem;
      color: #111;
      margin-bottom: 30px;
      text-align: center;
      max-width: 400px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }
    .landingBtn {
      background-color: #2E9DF7; /* charity: water blue */
      color: #fff;
      border: none; /* Removed border for cleaner mobile look */
      padding: 14px 32px;
      margin: 10px;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      box-shadow: 0 3px 6px rgba(46, 157, 247, 0.3);
      text-decoration: none;
    }
    
    .landingBtn:focus {
      outline: 4px solid #FFC907;
      outline-offset: 3px;
      box-shadow: 0 0 0 2px #fff, 0 0 0 6px #FFC907;
    }
    
    .landingBtn:focus-visible {
      outline: 4px solid #FFC907;
      outline-offset: 3px;
    }
    
    .landingBtn:hover {
      background-color: #FFC907; /* charity: water yellow on hover */
      color: #00263a; /* dark text on yellow background */
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(255, 201, 7, 0.4);
    }
    .landingBtn[style*="background-color:#FFC907"] {
      color: #222 !important; /* Ensure readable text on yellow */
    }
    .landingBtn[style*="background-color:#FFC907"]:hover {
      background-color: #e6b800 !important;
      color: #222 !important;
    }
    a:focus {
      outline: 3px solid #FFC907;
      outline-offset: 2px;
    }
    #didYouKnow {
      background: #FFFBEA;
      border-left: 6px solid #FFC907;
      color: #111;
      font-size: 1rem;
      margin: 16px 0 0 0;
      padding: 12px 18px 12px 14px;
      border-radius: 6px;
      box-shadow: 0 2px 8px #0001, 1px 1px 2px #fff;
      max-width: 500px;
      display: none;
      transition: opacity 0.5s;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }
    #didYouKnow a {
      color: #2E9DF7;
      text-decoration: underline;
      font-size: 0.98em;
      font-weight: bold;
    }
    #progressPath {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 10px auto;
      user-select: none;
      font-weight: bold;
      position: relative; /* Needed for absolute positioning of the character */
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.85);
      padding-bottom: 8px;
      z-index: 5;
    }
    #pathSVG {
      display: block;
      margin: 0 auto;
      background: none;
    }
    #milestoneLabels span {
      min-width: 40px;
      text-align: center;
      color: #222; /* Darker for better contrast */
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }

    /* Make SVGs and overlays responsive */
    #characterContainer, #characterSprite {
      max-width: 100vw;
      max-height: 25vh;
      width: 40px;
      height: 75px;
    }
    #progressPath, #pathSVG {
      width: 100%;
      max-width: 600px;
      min-width: 180px;
    }
    .choiceBtn, .landingBtn {
      font-size: 1rem;
      padding: 12px;
      width: 100%;
      max-width: 350px;
      box-sizing: border-box;
    }
    /* Responsive overlay for cut scenes and directions */
    #directionsCutScene, #schoolEndingScene, #glassCutScene, #wellCelebrationScene {
      max-width: 100vw;
      max-height: 100vh;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }
    
    /* Better responsive support for direction overlays */
    @media (max-height: 600px) {
      #directionsCutScene > div,
      #schoolEndingScene > div,
      #glassCutScene > div {
        max-height: 80vh;
        overflow-y: auto;
        padding: 15px;
      }
      #directionsCutScene img,
      #schoolEndingScene img,
      #glassCutScene img {
        max-width: 100px;
      }
    }
    /* Improved responsive design for all screen sizes */
    @media (max-width: 600px) {
      body {
        padding: 10px 10px 50px 10px; /* Reduced padding for more space */
      }
      #gameContainer {
        padding: 10px; /* Reduced padding */
        max-width: 98vw;
        margin: 0 auto;
      }
      #landingPage {
        padding: 15px 10px 60px 10px; /* Increased bottom padding for mobile */
        box-sizing: border-box;
        justify-content: flex-start; /* Ensure content starts at top */
        min-height: 100vh; /* Ensure full height */
      }
      h1 {
        font-size: 1.4rem;
        margin-bottom: 10px;
      }
      #landingTitle {
        font-size: 1.6rem; /* Slightly smaller for mobile */
        margin-bottom: 6px; /* Reduced margin */
      }
      #landingSubtitle {
        font-size: 0.95rem;
        margin-bottom: 15px; /* Reduced margin */
        max-width: 95%;
      }
      /* Reduce spacing around images */
      #landingPage img {
        margin-bottom: 10px !important;
      }
      #landingPage header img {
        margin-bottom: 8px !important;
        max-width: 160px !important;
      }
      #scoreArea, #statusBar, #storyText {
        font-size: 1em;
        padding: 8px 6px;
        margin: 8px 0; /* Reduced margins */
      }
      .choiceBtn, .landingBtn {
        font-size: 0.95rem;
        padding: 14px 12px; /* More generous padding for easier tapping */
        margin: 8px 0; /* Reduced margins between buttons */
        width: 100%;
        max-width: none; /* Remove max-width restriction */
      }
      .landingBtn {
        padding: 16px 12px; /* Even more padding for landing buttons */
        margin: 8px auto; /* Center the buttons */
        display: block;
        width: 100%;
        max-width: 280px; /* Set reasonable max-width */
      }
      #characterContainer, #characterSprite {
        width: 28px;
        height: 52px;
      }
      #progressPath, #pathSVG {
        min-width: 120px;
      }
      #milestoneLabels {
        font-size: 0.6em;
      }
      /* Difficulty selection improvements for mobile */
      nav > div {
        margin-bottom: 15px !important;
      }
      nav > div > div {
        flex-direction: column !important;
        gap: 8px !important;
      }
      nav > div label {
        font-size: 0.9rem !important;
        padding: 8px;
        background: rgba(255,255,255,0.8);
        border-radius: 4px;
        margin: 2px 0;
      }
      /* Ensure navigation buttons area has enough space */
      nav {
        width: 100% !important;
        margin-bottom: 20px !important;
      }
      nav > div:last-child {
        margin-bottom: 30px !important; /* Extra space for button container */
      }
    }

    /* Tablet responsive design */
    @media (min-width: 601px) and (max-width: 1024px) {
      #gameContainer {
        max-width: 700px;
        padding: 25px;
      }
      h1 {
        font-size: 2.2rem;
      }
      #storyText {
        font-size: 1.3rem;
      }
      .choiceBtn, .landingBtn {
        font-size: 1.1rem;
        padding: 14px;
        max-width: 400px;
      }
      #landingTitle {
        font-size: 2.5rem;
      }
      #landingSubtitle {
        font-size: 1.2rem;
        max-width: 500px;
      }
    }

    /* Large screen responsive design */
    @media (min-width: 1025px) {
      #gameContainer {
        max-width: 800px;
        padding: 30px;
      }
      h1 {
        font-size: 2.5rem;
      }
      #storyText {
        font-size: 1.4rem;
      }
      .choiceBtn, .landingBtn {
        font-size: 1.2rem;
        padding: 16px;
        max-width: 450px;
      }
      #landingTitle {
        font-size: 3rem;
      }
      #landingSubtitle {
        font-size: 1.3rem;
        max-width: 600px;
      }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      body {
        background: #000;
        color: #fff;
      }
      #gameContainer {
        background: #fff;
        border: 4px solid #000;
        color: #000;
      }
      .choiceBtn {
        border: 3px solid #000;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      #characterContainer {
        transition: none;
      }
      #gameContainer {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <!-- Skip navigation link for accessibility -->
  <a href="#gameContent" class="skip-link">Skip to main content</a>
  
  <!-- Landing Page Overlay -->
  <main id="landingPage" role="dialog" aria-modal="true" aria-labelledby="landingTitle" aria-describedby="landingSubtitle">
    <header>
      <img src="img/cw_logo_horizontal.png" alt="charity: water - bringing clean and safe drinking water to people in developing countries" style="max-width: 200px; margin-bottom: 15px; height: auto;">
    </header>
    
    <!-- Hero image showing the journey -->
    <img src="img/Girl with jerry can.jpg" alt="Young girl carrying a large yellow water container on a dusty path, representing the daily journey millions of girls take to collect water" style="max-width: 150px; height: auto; border-radius: 12px; border: 3px solid #FFC907; margin-bottom: 15px;">
    
    <h1 id="landingTitle">💧 The Long Walk: A Charity: Water Journey</h1>
    <p id="landingSubtitle">
      Every day, millions of girls walk miles for clean water.<br>
      Can you help her reach a brighter future?<br>
      <span style="color:#2E9DF7; font-weight:bold;">Play to experience her journey.</span>
    </p>
    
    <!-- Show clean water image as motivation -->
    <img src="img/Girl with cup of water..jpg" alt="Happy girl drinking from a clean cup of water, showing the positive impact of access to clean water" style="max-width: 120px; height: auto; border-radius: 8px; border: 2px solid #2E9DF7; margin: 10px 0;">
    
    <nav>
      <!-- Difficulty Selection -->
      <div style="margin-bottom: 20px;">
        <h2 style="font-size: 1.3rem; color: #005073; margin-bottom: 10px;">Choose Your Difficulty:</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 15px;">
          <label style="display: flex; align-items: center; font-size: 1rem; color: #222; cursor: pointer;">
            <input type="radio" name="difficulty" value="easy" checked style="margin-right: 8px; transform: scale(1.2);">
            <span style="color: #4FCB53; font-weight: bold;">Easy</span> - 6 pts to win, 6 energy
          </label>
          <label style="display: flex; align-items: center; font-size: 1rem; color: #222; cursor: pointer;">
            <input type="radio" name="difficulty" value="normal" style="margin-right: 8px; transform: scale(1.2);">
            <span style="color: #2E9DF7; font-weight: bold;">Normal</span> - 10 pts to win, 4 energy
          </label>
          <label style="display: flex; align-items: center; font-size: 1rem; color: #222; cursor: pointer;">
            <input type="radio" name="difficulty" value="hard" style="margin-right: 8px; transform: scale(1.2);">
            <span style="color: #F5402C; font-weight: bold;">Hard</span> - 15 pts to win, 3 energy
          </label>
        </div>
      </div>
      
      <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%;">
        <button class="landingBtn" id="startGameBtn" aria-label="Start the interactive water journey game">Start Game</button>
        <a href="https://www.charitywater.org/main" target="_blank" rel="noopener" aria-label="Learn more about Charity: Water's mission and donate" style="text-decoration: none;">
          <button class="landingBtn" style="background-color:#FFC907; color:#00263a; border-color:#2E9DF7;">Learn More About charity: water</button>
        </a>
      </div>
    </nav>
  </main>

  <main id="gameContainer" style="display:none;" role="main" aria-label="Water journey game content" tabindex="-1">
    <!-- charity: water logo watermark -->
    <img src="img/cw_logo.png" alt="charity: water logo" style="position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; opacity: 0.7; z-index: 5;">
    
    <header>
      <h1>The Long Walk: A Journey for Water</h1>
      <!-- Reset button for player control -->
      <button id="resetBtn" class="choiceBtn" style="max-width:200px; margin: 0 auto 10px auto; background-color:#F5402C;" aria-label="Reset game to beginning">Reset Game</button>
    </header>

    <!-- Add a clear score area at the top -->
    <section id="scoreSection" aria-label="Game progress">
      <div id="scoreArea" style="text-align:center; font-size:1.1em; margin-bottom:8px;" role="status" aria-live="polite">
        <div style="font-size: 0.9em; color: #666; margin-bottom: 4px;">
          <span id="difficultyDisplay">Easy Mode</span> - Need <span id="winConditionDisplay">6</span> points to win
        </div>
        Journey Points: <span id="scoreValue">0</span>
      </div>
      
      <!-- Progress path directly under the character's feet -->
      <div id="progressPath" role="img" aria-label="Journey progress map showing path from home to water source and back to village">
        <!-- Place the character icon absolutely over the SVG path -->
        <div id="characterContainer" aria-hidden="true">
          <img id="characterSprite" src="img/Girl with jerry can.jpg" alt="" style="width: 40px; height: 75px; object-fit: cover; border-radius: 50%; border: 2px solid #FFC907;">
        </div>
        <svg id="pathSVG" width="100%" height="60" viewBox="0 0 400 60" style="max-width: 100%; min-width: 200px;" role="img" aria-labelledby="pathDesc">
          <title id="pathDesc">Journey map showing path from home village to water source and back, with obstacles along the way</title>
          <!-- Winding path (brown) - only to river -->
          <path d="M 40 50 Q 120 10 200 40 Q 280 70 350 30" stroke="#8d5524" stroke-width="10" fill="none" stroke-linecap="round"/>
          <!-- Milestones (4 steps) -->
          <circle cx="40"  cy="50" r="13" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
          <circle cx="140" cy="20" r="11" fill="#FF902A" stroke="#F5402C" stroke-width="2"/>
          <circle cx="220" cy="45" r="11" fill="#8BD1CB" stroke="#159A48" stroke-width="2"/>
          <circle cx="350" cy="30" r="13" fill="#2E9DF7" stroke="#005073" stroke-width="3"/>
          <!-- Girl marker (moves along path) -->
          <circle id="girlMarker" cx="40" cy="50" r="12" fill="#c68642" stroke="#3e2723" stroke-width="2"/>
          <!-- Girl icon on the marker (simple head and dress) -->
          <g id="girlMiniIcon">
            <ellipse cx="40" cy="45" rx="4" ry="5" fill="#c68642"/>
            <ellipse cx="40" cy="55" rx="5" ry="7" fill="#4FCB53"/>
            <ellipse cx="40" cy="40" rx="5" ry="3" fill="#3e2723"/>
          </g>
          <!-- Simple SVG trees and rocks for jungle/forest feel -->
          <ellipse cx="100" cy="10" rx="8" ry="4" fill="#159A48"/>
          <rect x="95" y="5" width="4" height="8" fill="#8d5524"/>
          <ellipse cx="250" cy="60" rx="10" ry="5" fill="#159A48"/>
          <rect x="245" y="55" width="4" height="8" fill="#8d5524"/>
          <ellipse cx="400" cy="10" rx="7" ry="3" fill="#159A48"/>
          <rect x="397" y="7" width="3" height="6" fill="#8d5524"/>
          <ellipse cx="550" cy="55" rx="8" ry="4" fill="#159A48"/>
          <rect x="547" y="51" width="3" height="7" fill="#8d5524"/>
          <!-- Rocks -->
          <ellipse cx="180" cy="55" rx="5" ry="2" fill="#bfa77a"/>
          <ellipse cx="620" cy="40" rx="6" ry="3" fill="#bfa77a"/>
        </svg>
        <!-- Milestone labels for the journey map -->
        <div id="milestoneLabels" style="display: flex; justify-content: space-between; font-size: 0.7em; color: #555; margin-top: 16px; margin-bottom: 4px;" aria-hidden="true">
          <span>home</span>
          <span>obstacles</span>
          <span>water source</span>
          <span>village</span>
        </div>
      </div>
    </section>

    <section id="gameContent" aria-label="Game story and choices">
      <div id="storyText" role="status" aria-live="polite" style="background: rgba(255, 255, 255, 0.85); padding: 15px; border-radius: 8px; margin-bottom: 15px; backdrop-filter: blur(2px);">Click "Start" to begin the journey.</div>
      <div id="didYouKnow" style="display:none; background: rgba(255, 201, 7, 0.7); padding: 12px; border-radius: 6px; margin-bottom: 10px; backdrop-filter: blur(3px); border: 1px solid rgba(255, 201, 7, 0.4);" role="complementary" aria-label="Educational information">
        <!-- Did You Know box will be filled by JS -->
      </div>
      <div id="choices" role="group" aria-label="Available choices"></div>
    </section>

    <div id="statusBar" role="status" aria-live="polite" style="background: rgba(255, 255, 255, 0.8); padding: 8px 12px; border-radius: 6px; margin: 10px 0; backdrop-filter: blur(2px);"></div>
    
    <!-- Audio elements for ambient and SFX -->
    <audio id="ambientWind" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b5b3b2e2.mp3" loop aria-label="Background wind sounds"></audio>
    <audio id="ambientFootsteps" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e7.mp3" loop aria-label="Footstep sounds"></audio>
    <audio id="ambientSchoolBell" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3" aria-label="School bell sound"></audio>
    <audio id="sfxClick" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3" aria-label="Click sound effect"></audio>
    <audio id="sfxVictory" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3" aria-label="Victory sound"></audio>
    <audio id="sfxLoss" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3" aria-label="Loss sound"></audio>
  </main>

  <script>
    let currentStep = 0;
    let energy = 4; // Will be set based on difficulty
    let score = 0; // Start Journey Points at 0
    let lastScore = 0; // Track last score for feedback
    let wentAlone = false; // Track if player chose 'Go alone'
    let returning = false; // Track if player is returning home
    
    // Difficulty system
    let currentDifficulty = 'easy'; // Default to easy
    const difficultySettings = {
      easy: {
        startingEnergy: 6,
        winCondition: 6,
        pointsPerChoice: 3,
        energyPenalty: 1,
        factDisplayTime: 20000, // 20 seconds
        name: "Easy",
        description: "More forgiving journey with helpful guidance"
      },
      normal: {
        startingEnergy: 4,
        winCondition: 10,
        pointsPerChoice: 2,
        energyPenalty: 1,
        factDisplayTime: 15000, // 15 seconds
        name: "Normal", 
        description: "Balanced challenge representing real experiences"
      },
      hard: {
        startingEnergy: 3,
        winCondition: 15,
        pointsPerChoice: 1,
        energyPenalty: 2,
        factDisplayTime: 10000, // 10 seconds
        name: "Hard",
        description: "Challenging journey requiring careful planning"
      }
    };

    const storyText = document.getElementById('storyText');
    const choicesContainer = document.getElementById('choices');
    const statusBar = document.getElementById('statusBar');

    // Shorter story: only 8 steps, matching the map and milestones
    const storySteps = [
      {
        text: "You wake up early. Your family's only water source is 3 miles away. What do you do?",
        choices: [
          { text: "Go to school", effect: () => {}, next: null, endMessage: "You went to school, but your family is limited tonight on what they can eat and drink. Education is important, but so is water. Maybe next time you can help both!" },
          { text: "🪣 Grab the yellow jerry can and start on your trail", effect: () => {}, next: 1 }
        ]
      },
      {
        text: "You meet your friend Amina at the edge of the village. She offers to walk with you. What do you do?",
        choices: [
          { text: "Walk together", effect: () => { wentAlone = false; }, next: 2 },
          { text: "Go alone", effect: () => { window.doublePointsThisStep = true; wentAlone = true; }, next: 2 }
        ]
      },
      {
        text: "There’s broken glass ahead. What do you do?",
        choices: [
          { text: "Step carefully around it", effect: () => {}, next: 3 },
          { text: "Run through it quickly", effect: () => {}, next: 3, glassCutScene: true },
          { text: "Ask Amina for help", effect: () => { window.broomCutScene = true; }, next: 3 }
        ]
      },
      {
        text: "A snake is coiled in the path. What do you do?",
        choices: [
          { text: "Walk around slowly", effect: () => { window.snakeWalkAroundCutScene = true; }, next: 4 },
          { text: "Throw a rock at it", effect: () => { energy--; }, next: 4 },
          { text: "Wait for it to leave", effect: () => { energy = energy - 1; window.skipJourneyPointsThisStep = true; window.snakeWaitCutScene = true; }, next: 4 }
        ]
      },
      {
        text: "You reach a muddy patch. What do you do?",
        choices: [
          { text: "Rest for a moment", effect: () => { energy = energy + 2; window.muddyPatchRestCutScene = true; }, next: 5 },
          { text: "Push through", effect: () => { energy = energy - 2; window.muddyPatchPushThroughCutScene = true; }, next: 5 },
          { text: "Try to find another way around", effect: () => { showLostInBrushCutScene(); }, next: null }
        ]
      },
      {
        text: "You see a wild dog in the road. What do you do?",
        choices: [
          // If you stand your ground, just continue to the next step
          { text: "Stand your ground. Ignore the dog and keep walking past it.", effect: () => {}, next: 6 },
          // If you distract the dog, set the flag for the cut scene (do not advance step here)
          { text: "Distract the dog by tossing something into the brush, then run past it yelling.", effect: () => { window.wildDogCutScene = true; }, next: null }
        ]
      },
      {
        text: "You finally reach the river! The water source is busy with other villagers. What do you do?",
        choices: [
          // Wait patiently in line
          { text: "Wait patiently in line with the other villagers", effect: () => { energy = energy - 1; }, next: 7 },
          { text: "Ask if you can help carry water for an elderly woman", effect: () => { score += difficultySettings[currentDifficulty].pointsPerChoice; }, next: 7 }
        ]
      },
      {
        text: "You made it to the water! Time to head home.",
        choices: [
          { text: "Finish the journey", effect: () => {}, next: null }
        ]
      }
    ];

    // Array of background images for each scene
    // (You can replace these URLs with your own or other free images)
    const backgroundImages = [
      // Girl waking up - using custom image
      "img/girl waking up.png",
      // Meeting Amina - using custom image
      "img/girlreachinghand.png",
      // Broken glass scene - using custom image
      "img/girlwithbrokenglass.png",
      // Snake encounter - using custom image
      "img/girl with snake.png",
      // Muddy patch scene - using custom image
      "img/girlwithmud.png",
      // Vibrant well with children
      "https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=600&q=80"
    ];

    // Function to set the background image for the current step
    function setBackground(step) {
      // Get the game container element
      const gameContainer = document.getElementById('gameContainer');
      // If step is valid, set the background image
      if (backgroundImages[step]) {
        gameContainer.style.backgroundImage = `url('${backgroundImages[step]}')`;
      } else {
        // Default background if step is out of range
        gameContainer.style.backgroundImage = '';
      }
    }

    // Update the map SVG and milestone positions for the journey
    const journeyPositions = [
      {cx:40, cy:50},    // Home
      {cx:140, cy:20},  // Obstacles
      {cx:220, cy:45},  // Water Source
      {cx:350, cy:30}   // Village
    ];

    // Map each story step to a milestone index on the map
    // 0 = home, 1 = obstacles, 2 = water source, 3 = village
    // The icon moves to show progress through the journey
    const stepToMilestone = [
      0, // Step 0: wake up at home
      0, // Step 1: still at home area
      1, // Step 2: encountering obstacles (broken glass)
      1, // Step 3: more obstacles (snake)
      1, // Step 4: continuing through obstacles (muddy patch)
      1, // Step 5: final obstacle (wild dog)
      2, // Step 6: reaching the water source (busy with villagers)
      3  // Step 7: returning to village with water
    ];

    // Move the character to the correct milestone for the current story step
    function moveCharacter(step) {
      // Use the mapping to get the milestone index
      let idx = stepToMilestone[step] || 0;
      if (returning) {
        idx = 3 - idx; // Reverse the index for return
      }
      const character = document.getElementById('characterContainer');
      const pathSVG = document.getElementById('pathSVG');
      const svgRect = pathSVG.getBoundingClientRect();
      const scaleX = svgRect.width / 400;
      const scaleY = svgRect.height / 60;
      const left = journeyPositions[idx].cx * scaleX - character.offsetWidth / 2;
      const top = journeyPositions[idx].cy * scaleY - character.offsetHeight + 30; // 30px offset to align feet
      // Set the position
      character.style.left = `${left}px`;
      character.style.top = `${top}px`;
    }

    // Update the marker on the SVG path to match the story step
    function updatePathMarker(step) {
      let idx = stepToMilestone[step] || 0;
      if (returning) {
        idx = 3 - idx;
      }
      const marker = document.getElementById('girlMarker');
      const miniIcon = document.getElementById('girlMiniIcon');
      marker.setAttribute('cx', journeyPositions[idx].cx);
      marker.setAttribute('cy', journeyPositions[idx].cy);
      // Move the mini icon group to match the marker
      miniIcon.setAttribute('transform', `translate(${journeyPositions[idx].cx - 40},${journeyPositions[idx].cy - 50})`);
    }

    // Get audio elements
    const ambientWind = document.getElementById('ambientWind');
    const ambientFootsteps = document.getElementById('ambientFootsteps');
    const ambientSchoolBell = document.getElementById('ambientSchoolBell');
    const sfxClick = document.getElementById('sfxClick');
    const sfxVictory = document.getElementById('sfxVictory');
    const sfxLoss = document.getElementById('sfxLoss');

    // Helper to play a sound from the start
    function playSound(audio) {
      audio.currentTime = 0;
      audio.play();
    }

    // Show a directions cut scene at the start of the game (now with two screens)
    function showDirectionsCutScene() {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('directionsCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'directionsCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // First screen: introduction
      overlay.innerHTML = `
        <div style="padding: 20px; max-width: 500px; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; align-items: center; text-align: center;">
          <img src="img/Girl with jerry can.jpg" alt="Young girl carrying a large yellow water container, representing millions of girls who walk long distances daily to collect water for their families" style="width: 100%; max-width: 140px; height: auto; border-radius: 10px; border: 2px solid #FFC907; margin-bottom: 15px;">
          <div id="directionsIntro" style="font-size:1.1em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:420px; line-height: 1.4;">
            <span style="font-size:1.3em;">Welcome to The Long Walk: A Journey for Water</span><br><br>
            This story is based on the true journeys of girls in countries like Ethiopia, Uganda, and India.<br><br>
            Today, you will follow <span style='color:#4FCB53;'>Amina</span> as she walks miles to collect water for her family.<br><br>
            <span style='color:#F5402C;'>Your choices will affect what happens to Amina and her village.</span><br><br>
          </div>
          <button id="nextDirectionsBtn" class="choiceBtn" style="max-width:220px; margin-top: 10px;" aria-label="Continue to game instructions">Next</button>
        </div>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When 'Next' is clicked, show the instructions screen
      document.getElementById('nextDirectionsBtn').onclick = function() {
        // Replace the content with instructions
        overlay.innerHTML = `
          <div style="padding: 20px; max-width: 500px; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; align-items: center; text-align: center;">
            <img src="img/clean and dirty water cups.jpg" alt="Two cups side by side showing the contrast between clean, clear drinking water and dirty, contaminated water with visible particles and debris" style="width: 100%; max-width: 160px; height: auto; border-radius: 8px; border: 2px solid #2E9DF7; margin-bottom: 12px;">
            <div id="directionsInstructions" style="font-size:1.0em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:420px; line-height: 1.4;">
              <div style="background: rgba(255,201,7,0.2); padding: 8px; border-radius: 6px; margin-bottom: 12px;">
                <strong>${difficultySettings[currentDifficulty].name} Mode:</strong><br>
                ${difficultySettings[currentDifficulty].description}
              </div>
              <span style='color:#2E9DF7;'>Journey Points:</span> Make good choices to earn points. You need <b>${difficultySettings[currentDifficulty].winCondition} Journey Points</b> to win and help the village get a new well!<br><br>
              <span style='color:#159A48;'>Energy:</span> You start with <b>${difficultySettings[currentDifficulty].startingEnergy} Energy</b>. If you lose all your energy, Amina must turn back and her family won't get water that day.<br><br>
              The more people play and help Amina, the more is donated to <a href='https://www.charitywater.org/' target='_blank' style='color:#2E9DF7;' aria-label="Visit charity: water website to learn more and donate">Charity: Water</a>.<br><br>
              <span style='color:#FFC907;'>Are you ready to help Amina on her journey?</span>
            </div>
            <img src="img/water-can.png" alt="Yellow plastic water container used for collecting and carrying water during the long journey to water sources" style="width: 100%; max-width: 70px; height: auto; margin-bottom: 12px;">
            <button id="startJourneyBtn" class="choiceBtn" style="max-width:220px; background-color:#4FCB53; border-color:#FFC907; margin-top: 10px;" aria-label="Start Amina's water collection journey">Start Journey</button>
          </div>
        `;
        // When 'Start Journey' is clicked, remove overlay and start the story
        document.getElementById('startJourneyBtn').onclick = function() {
          overlay.remove();
          updateDifficultyDisplay();
          showStep();
        };
      };
    }

    // Start ambient sounds when game starts
    function startGame() {
      // Get selected difficulty
      const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked');
      if (selectedDifficulty) {
        currentDifficulty = selectedDifficulty.value;
      }
      
      currentStep = 0;
      energy = difficultySettings[currentDifficulty].startingEnergy;
      score = 0; // Reset Journey Points to 0
      lastScore = 0;
      returning = false; // Reset return flag
      setBackground(currentStep);
      moveCharacter(currentStep);
      updatePathMarker(currentStep);
      choicesContainer.innerHTML = '';
      // Hide the well scene if it exists
      hideWellScene();
      ambientWind.volume = 0.3;
      ambientWind.play();
      ambientFootsteps.volume = 0.2;
      ambientFootsteps.play();
      // Show the directions cut scene first
      showDirectionsCutScene();
    }

    // Update difficulty display in UI
    function updateDifficultyDisplay() {
      const difficultyDisplay = document.getElementById('difficultyDisplay');
      const winConditionDisplay = document.getElementById('winConditionDisplay');
      const scoreValue = document.getElementById('scoreValue');
      
      if (difficultyDisplay) {
        difficultyDisplay.textContent = `${difficultySettings[currentDifficulty].name} Mode`;
      }
      if (winConditionDisplay) {
        winConditionDisplay.textContent = difficultySettings[currentDifficulty].winCondition;
      }
      if (scoreValue) {
        scoreValue.textContent = score;
      }
    }

    // Stop all ambient sounds
    function stopAmbient() {
      ambientWind.pause();
      ambientWind.currentTime = 0;
      ambientFootsteps.pause();
      ambientFootsteps.currentTime = 0;
      ambientSchoolBell.pause();
      ambientSchoolBell.currentTime = 0;
    }

    // Array of "Did You Know?" facts
    const didYouKnowFacts = [
      "1 in 10 people lack access to clean water.",
      "Girls in sub-Saharan Africa spend 4x more time fetching water than boys.",
      "Access to clean water means more time for school and play.",
      "Diseases from dirty water kill more people every year than all forms of violence, including war.",
      // New facts about charity: water
      "Charity: water has funded over 111,000 water projects around the world.",
      "Thanks to charity: water, more than 15 million people now have clean water.",
      "100% of public donations to charity: water go directly to clean water projects.",
      "Charity: water works in 29 countries to help people get safe water.",
      "Clean water from charity: water projects helps kids spend more time in school.",
      "Learn more inspiring stories at <a href='https://www.charitywater.org/stories' target='_blank'>charitywater.org/stories</a>."
    ];

    // Show a random Did You Know box after each decision
    function showDidYouKnow() {
      const box = document.getElementById('didYouKnow');
      // Pick a random fact except the last one (save last for ending)
      const factIndex = Math.floor(Math.random() * (didYouKnowFacts.length - 1));
      box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[factIndex]}`;
      box.style.display = 'block';
      box.style.opacity = '1';
      // Show the fact for difficulty-based time
      const displayTime = difficultySettings[currentDifficulty].factDisplayTime;
      setTimeout(() => {
        box.style.opacity = '0';
        setTimeout(() => { box.style.display = 'none'; }, 500);
      }, displayTime);
    }

    function updateScoreDisplay() {
      const scoreValue = document.getElementById('scoreValue');
      if (!scoreValue) return;
      scoreValue.textContent = score;
      // Show feedback if score changed
      if (score !== lastScore) {
        const diff = score - lastScore;
        const feedback = document.createElement('span');
        feedback.textContent = diff > 0 ? ` +${diff}` : ` ${diff}`;
        feedback.style.color = diff > 0 ? "#4FCB53" : "#F5402C";
        feedback.style.fontWeight = "bold";
        feedback.style.marginLeft = "8px";
        scoreValue.parentElement.appendChild(feedback);
        setTimeout(() => feedback.remove(), 1200);
        lastScore = score;
      }
    }

    // Helper function to check if energy is 0 or less and end the game
    function checkGameOver() {
      // If energy is 0 or less, show the Game Over cut scene right away
      if (energy <= 0) {
        endGame();
        return true; // Game is over
      }
      return false; // Game continues
    }

    // In showStep, always add 2 journey points per step, or 4 if double points
    function showStep() {
      // Check for the muddy patch rest cut scene FIRST
      if (window.muddyPatchRestCutScene) {
        showMuddyPatchRestCutScene(() => {
          window.muddyPatchRestCutScene = false;
          // After the cut scene, check if energy is 0 or less
          if (energy <= 0) {
            endGame();
            return;
          }
          // Go to the next step after muddy patch (step 5: boys playing soccer)
          currentStep = 5;
          showStep(); // Call showStep() to continue the game
          showDidYouKnow();
        });
        return;
      }
      // Check for the muddy patch push through cut scene FIRST
      if (window.muddyPatchPushThroughCutScene) {
        showMuddyPatchPushThroughCutScene(() => {
          window.muddyPatchPushThroughCutScene = false;
          // After the cut scene, check if energy is 0 or less
          if (energy <= 0) {
            endGame();
            return;
          }
          // Go to the next step after muddy patch (step 5: boys playing soccer)
          currentStep = 5;
          showStep(); // Call showStep() to continue the game
          showDidYouKnow();
        });
        return;
      }
      // Always check if energy is 0 or less before doing anything else
      // If so, show the Game Over cut scene and stop the game
      if (checkGameOver()) {
        return;
      }
      // Set the background for the current step
      setBackground(currentStep);
      // Move the character and marker to match the story's progress on the map
      moveCharacter(currentStep);
      updatePathMarker(currentStep);

      // If the game is over, show the ending
      if (
        currentStep >= storySteps.length ||
        energy <= 0 ||
        storySteps[currentStep].choices.every(choice => choice.next === null)
      ) {
        // If the ending is from a choice with a custom endMessage, show it
        const lastStep = storySteps[currentStep] || {};
        const chosen = lastStep.choices && lastStep.choices.find(c => c.next === null && c.endMessage);
        if (chosen && chosen.endMessage) {
          // Show a gentle overlay scene for the 'Go to school' ending
          showSchoolEndingScene(chosen.endMessage);
          // Stop the game here so it does not continue
          return;
        }
        endGame();
        return;
      }

      // Special logic: If player went alone, hide 'Ask Amina for help' in the glass step
      let step = storySteps[currentStep];
      let choicesToShow = step.choices;
      // If this is the glass step and player went alone, filter out the help option
      if (step.text.includes("broken glass") && wentAlone) {
        choicesToShow = step.choices.filter(choice => !choice.text.includes("Amina"));
      }
      storyText.textContent = step.text;
      storyText.focus();
      choicesContainer.innerHTML = '';

      // Show choices for this step
      choicesToShow.forEach((choice, idx) => {
        const btn = document.createElement('button');
        btn.classList.add('choiceBtn');
        btn.textContent = choice.text;
        btn.setAttribute('aria-label', `Choice ${idx + 1}: ${choice.text}`);
        btn.setAttribute('tabindex', '0');
        
        // Add keyboard navigation
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
        btn.onclick = () => {
          playSound(sfxClick); // Play click sound
          // If this is the 'Go alone' choice, show the cut scene and double points
          if (step.text.includes("Amina") && choice.text.includes("Go alone")) {
            showGoAloneScene(() => {
              choice.effect(); // Set doublePointsThisStep and wentAlone
              // Always add double journey points for this special choice
              score += difficultySettings[currentDifficulty].pointsPerChoice * 2;
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          choice.effect();
          // --- Fix for wild dog cut scene: if the flag is set, show the cut scene and return immediately ---
          if (window.wildDogCutScene) {
            // After the wild dog cut scene, subtract 2 energy. If energy is now 0 or less, show game over. Otherwise, go to the next step.
            showWildDogCutScene(() => {
              window.wildDogCutScene = false;
              energy = energy - difficultySettings[currentDifficulty].energyPenalty * 2; // Lose double energy for running past the dog
              if (energy <= 0) {
                // If energy is 0 or less, show the game over cut scene
                endGame();
                return;
              }
              currentStep++; // Go to the next step
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // If this is the snake step and player throws a rock, show the snake bite scene and end the game
          if (step.text.includes("snake") && choice.text.includes("Throw a rock")) {
            showSnakeBiteScene(() => {
              energy = 0;
              endGame();
            });
            return;
          }
          // If this choice ends the game, show the overlay and stop
          if (choice.endMessage) {
            showSchoolEndingScene(choice.endMessage);
            return;
          }
          // If this choice triggers the glass cut scene, show it and stop
          if (choice.glassCutScene) {
            showGlassCutScene(() => {
              // Do NOT add journey points for this step, just move to next
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // If this choice triggers the broom cut scene, show it and stop
          if (window.broomCutScene) {
            showBroomCutScene(() => {
              // Always add double journey points for teamwork
              score += difficultySettings[currentDifficulty].pointsPerChoice * 2;
              energy = energy - difficultySettings[currentDifficulty].energyPenalty; // Lose energy for the effort
              window.broomCutScene = false;
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // For all other steps, add points based on difficulty
          if (!window.skipJourneyPointsThisStep) {
            score += difficultySettings[currentDifficulty].pointsPerChoice;
          } else {
            // If skipJourneyPointsThisStep is true, do not add journey points
            window.skipJourneyPointsThisStep = false; // Reset the flag for next step
          }
          if (typeof choice.next === "number") {
            currentStep = choice.next;
          } else {
            currentStep++;
          }
          showStep();
          showDidYouKnow();
        };
        choicesContainer.appendChild(btn);
      });

      updateStatus();
      updateScoreDisplay(); // Update score visually

      // Check for the snake wait cut scene
      if (window.snakeWaitCutScene) {
        // Show the cut scene and then continue
        showSnakeWaitCutScene(() => {
          window.snakeWaitCutScene = false;
          currentStep = 5;
          showStep();
          showDidYouKnow();
        });
        return;
      }

      // Check for the snake walk around cut scene
      if (window.snakeWalkAroundCutScene) {
        showSnakeWalkAroundCutScene(() => {
          window.snakeWalkAroundCutScene = false;
          currentStep = 5;
          showStep();
          showDidYouKnow();
        });
        return;
      }
    }

    function updateStatus() {
      // Show only Energy and Journey Points in the status bar
      statusBar.textContent = `Energy: ${energy} | Journey Points: ${score}`;
      
      // Announce status changes to screen readers
      const announcement = `Current status: ${energy} energy remaining, ${score} journey points earned`;
      const srAnnouncement = document.createElement('div');
      srAnnouncement.setAttribute('aria-live', 'polite');
      srAnnouncement.setAttribute('aria-atomic', 'true');
      srAnnouncement.style.position = 'absolute';
      srAnnouncement.style.left = '-9999px';
      srAnnouncement.textContent = announcement;
      document.body.appendChild(srAnnouncement);
      
      // Remove announcement after it's read
      setTimeout(() => {
        document.body.removeChild(srAnnouncement);
      }, 1000);
    }

    function endGame() {
      choicesContainer.innerHTML = '';
      stopAmbient();

      const winCondition = difficultySettings[currentDifficulty].winCondition;

      // Check if player won based on difficulty settings
      if (currentStep === 7 && score >= winCondition) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        showWellCelebrationScene();
        storyText.innerHTML = `You made it! With clean water, your family is healthier and happier.<br><br><strong>${difficultySettings[currentDifficulty].name} Mode Completed!</strong>`;
        playSound(sfxVictory);
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
        storyText.focus();
        const restart = document.createElement('button');
        restart.classList.add('choiceBtn');
        restart.textContent = 'Play Again';
        restart.onclick = () => {
          // Go back to landing page to allow difficulty change
          const landingPage = document.getElementById('landingPage');
          const gameContainer = document.getElementById('gameContainer');
          
          gameContainer.style.display = 'none';
          gameContainer.setAttribute('aria-hidden', 'true');
          
          landingPage.style.display = 'flex';
          landingPage.setAttribute('aria-hidden', 'false');
          
          landingPage.focus();
          hideWellScene();
        };
        choicesContainer.appendChild(restart);
        updateStatus();
        updateScoreDisplay();
        return;
      }
      // If you finished the journey but have less than required points
      if (currentStep === 7 && score < winCondition) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        storyText.innerHTML = `You finished, but you need ${winCondition} Journey Points to win in ${difficultySettings[currentDifficulty].name} Mode. Try again!`;
        playSound(sfxLoss);
        const restart = document.createElement('button');
        restart.classList.add('choiceBtn');
        restart.textContent = 'Try Again';
        restart.onclick = () => {
          // Go back to landing page to allow difficulty change
          const landingPage = document.getElementById('landingPage');
          const gameContainer = document.getElementById('gameContainer');
          
          gameContainer.style.display = 'none';
          gameContainer.setAttribute('aria-hidden', 'true');
          
          landingPage.style.display = 'flex';
          landingPage.setAttribute('aria-hidden', 'false');
          
          landingPage.focus();
        };
        choicesContainer.appendChild(restart);
        updateStatus();
        updateScoreDisplay();
        return;
      }
      // If energy is 0, show the Game Over cut scene
      if (energy <= 0) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        storyText.innerHTML = "You ran out of energy and couldn't continue. <br> Try again to learn how to stay safe.";
        playSound(sfxLoss);
        // Show last fact (link to stories)
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
      } else {
        updatePathMarker(6);
        moveCharacter(backgroundImages.length - 1);

        // Show a special well scene at the end
        showWellCelebrationScene();

        // Only show a simple ending message (removed schoolProgress logic)
        storyText.innerHTML = "You made it! With clean water, your family is healthier and happier.";
        playSound(sfxVictory);
        // Show last fact (link to stories)
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
      }
      storyText.focus();        const restart = document.createElement('button');
        restart.classList.add('choiceBtn');
        restart.textContent = 'Play Again';
        restart.onclick = () => {
          // Go back to landing page to allow difficulty change
          const landingPage = document.getElementById('landingPage');
          const gameContainer = document.getElementById('gameContainer');
          
          gameContainer.style.display = 'none';
          gameContainer.setAttribute('aria-hidden', 'true');
          
          landingPage.style.display = 'flex';
          landingPage.setAttribute('aria-hidden', 'false');
          
          landingPage.focus();
          hideWellScene();
        };
      choicesContainer.appendChild(restart);
      updateStatus();
      updateScoreDisplay(); // Show final score
      // Show a summary message based on score and difficulty
      const scoreArea = document.getElementById('scoreArea');
      if (scoreArea) {
        const winCondition = difficultySettings[currentDifficulty].winCondition;
        let msg = "";
        if (score >= winCondition + 5) {
          msg = `Amazing! You exceeded the ${difficultySettings[currentDifficulty].name} mode goal!`;
        } else if (score >= winCondition) {
          msg = `Great job! You completed ${difficultySettings[currentDifficulty].name} mode successfully!`;
        } else {
          msg = `Try again to reach ${winCondition} points in ${difficultySettings[currentDifficulty].name} mode!`;
        }
        scoreArea.innerHTML = `<div style="font-size: 0.9em; color: #666; margin-bottom: 4px;">
          ${difficultySettings[currentDifficulty].name} Mode - Need ${winCondition} points to win
        </div>Journey Points: <span id="scoreValue">${score}</span> <br><span style="color:#159A48;">${msg}</span>`;
      }
    }

    // Show a well celebration scene at the end of the game
    function showWellCelebrationScene() {
      // Remove any previous well scene if present
      let oldWell = document.getElementById('wellCelebrationScene');
      if (oldWell) oldWell.remove();

      // Create a new div for the well scene
      const wellDiv = document.createElement('div');
      wellDiv.id = 'wellCelebrationScene';
      wellDiv.style.position = 'absolute';
      wellDiv.style.left = '50%';
      wellDiv.style.top = '50%';
      wellDiv.style.transform = 'translate(-50%, -40%)';
      wellDiv.style.zIndex = '20';
      wellDiv.style.background = 'rgba(255,255,255,0.95)';
      wellDiv.style.borderRadius = '12px';
      wellDiv.style.boxShadow = '0 4px 24px #0002';
      wellDiv.style.padding = '18px 24px 12px 24px';
      wellDiv.style.textAlign = 'center';

      // SVG well and happy people
      wellDiv.innerHTML = `
        <img src="img/Girl with cup of water..jpg" alt="Girl celebrating with clean water" style="max-width:180px; height:auto; margin-bottom:12px; border-radius:12px; border:3px solid #FFC907;">
        <div style="color:#2E9DF7; font-size:1.2em; font-weight:bold; margin-top:8px;">
          🎉 Thanks to <span style="color:#FFC907;">charity: water</span>, your village has a new well! 🎉<br>
          <span style="color:#159A48;">Now you don't have to walk so far for water.</span>
        </div>
      `;
      document.getElementById('gameContainer').appendChild(wellDiv);
    }

    // Optionally hide the well scene if needed
    function hideWellScene() {
      let oldWell = document.getElementById('wellCelebrationScene');
      if (oldWell) oldWell.remove();
    }

    // Hide landing page and start game when Start Game is clicked
    document.getElementById('startGameBtn').onclick = function() {
      // Hide the landing page
      const landingPage = document.getElementById('landingPage');
      const gameContainer = document.getElementById('gameContainer');
      
      landingPage.style.display = 'none';
      landingPage.setAttribute('aria-hidden', 'true');
      
      gameContainer.style.display = 'block';
      gameContainer.setAttribute('aria-hidden', 'false');
      
      // Focus on the game container for screen readers
      gameContainer.focus();
      
      // Start the game
      startGame();
    };

    // Add event listener for the Reset button
    document.getElementById('resetBtn').onclick = function() {
      // Stop any ambient sounds
      stopAmbient();
      
      // Hide the game container
      const landingPage = document.getElementById('landingPage');
      const gameContainer = document.getElementById('gameContainer');
      
      gameContainer.style.display = 'none';
      gameContainer.setAttribute('aria-hidden', 'true');
      
      landingPage.style.display = 'flex';
      landingPage.setAttribute('aria-hidden', 'false');
      
      // Focus on the landing page for screen readers
      landingPage.focus();
      
      // Reset any overlays that might be showing
      const overlays = ['directionsCutScene', 'schoolEndingScene', 'glassCutScene', 'wellCelebrationScene', 'snakeBiteScene', 'goAloneScene', 'snakeWaitCutScene', 'lostInBrushCutScene', 'muddyPatchRestCutScene', 'muddyPatchPushThroughCutScene', 'wildDogCutScene', 'dirtyWaterCutScene', 'broomCutScene'];
      overlays.forEach(overlayId => {
        const overlay = document.getElementById(overlayId);
        if (overlay) overlay.remove();
      });
    };

    // Function to show a gentle overlay scene if the player chooses 'Go to school'
    function showSchoolEndingScene(message) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('schoolEndingScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'schoolEndingScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a gentle message and a Restart button
      overlay.innerHTML = `
        <img src="img/Girl with cup of water..jpg" alt="Girl with clean water" style="max-width: 120px; height: auto; border-radius: 8px; border: 2px solid #FFC907; margin-bottom: 12px;">
        <div style="font-size:1.3em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:400px;">
          ${message}
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:18px; max-width:400px;">
          Your family is proud of your learning, but tonight there is less water and food to share. <br> <span style='color:#FFC907;'>Clean water helps everyone thrive!</span>
        </div>
        <button id="restartSchoolBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Restart</button>
      `;
      // Add the overlay to the game container
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Restart button
      document.getElementById('restartSchoolBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Go back to landing page to allow difficulty change
        const landingPage = document.getElementById('landingPage');
        const gameContainer = document.getElementById('gameContainer');
        
        gameContainer.style.display = 'none';
        gameContainer.setAttribute('aria-hidden', 'true');
        
        landingPage.style.display = 'flex';
        landingPage.setAttribute('aria-hidden', 'false');
        
        landingPage.focus();
      };
    }

    // Show a simple cut scene if glass breaks off in her sandal
    function showGlassCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('glassCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'glassCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a gentle message, a simple SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Ouch! Some glass broke off in your sandal. You need to slow down and be careful.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span> and <span style='color:#2E9DF7;'>1 Journey Point</span>.
        </div>
        <svg width="80" height="60" viewBox="0 0 80 60" style="margin-bottom:16px;">
          <ellipse cx="40" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <rect x="30" y="30" width="20" height="12" rx="6" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
          <polygon points="40,38 44,44 36,44" fill="#F5402C" opacity="0.7"/>
          <rect x="38" y="44" width="4" height="8" rx="2" fill="#8d5524"/>
          <polyline points="42,44 44,48 40,50 36,48 38,44" fill="none" stroke="#6d4c24" stroke-width="2"/>
          <line x1="40" y1="44" x2="40" y2="50" stroke="#F5402C" stroke-width="2"/>
        </svg>
        <button id="continueGlassBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueGlassBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Always subtract energy and journey point for running through glass based on difficulty
        energy = energy - difficultySettings[currentDifficulty].energyPenalty;
        score = score - 1; // Always subtract exactly 1 Journey Point (not difficulty-based)
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene for teamwork with Amina to sweep away the glass
    function showBroomCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('broomCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'broomCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add teamwork message, SVG, and Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You and Amina find some sticks and make brooms.<br>
          Working together, you sweep away the glass so it's safe to walk!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span> (it was hard work),<br>
          but you earn <span style='color:#2E9DF7;'>double Journey Points</span> for teamwork!
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Two stick brooms and some glass -->
          <rect x="20" y="40" width="6" height="18" rx="2" fill="#8d5524"/>
          <rect x="64" y="40" width="6" height="18" rx="2" fill="#8d5524"/>
          <ellipse cx="23" cy="58" rx="7" ry="4" fill="#FFC907"/>
          <ellipse cx="67" cy="58" rx="7" ry="4" fill="#FFC907"/>
          <polygon points="45,50 50,55 40,55" fill="#2E9DF7" opacity="0.5"/>
          <polygon points="55,52 60,57 50,57" fill="#2E9DF7" opacity="0.5"/>
        </svg>
        <button id="continueBroomBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueBroomBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player is bitten by a snake
    function showSnakeBiteScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('snakeBiteScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'snakeBiteScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Oh no! You stumble and the snake bites you.<br>
          You become ill and must return home without water.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          Your family will have to wait for water. Try again and be careful next time!
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple snake and bite illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <path d="M20 50 Q45 10 70 50" stroke="#159A48" stroke-width="6" fill="none"/>
          <circle cx="70" cy="50" r="6" fill="#159A48"/>
          <circle cx="72" cy="48" r="1.5" fill="#fff"/>
          <circle cx="68" cy="48" r="1.5" fill="#fff"/>
          <ellipse cx="70" cy="54" rx="2" ry="1" fill="#F5402C"/>
          <rect x="40" y="44" width="10" height="6" rx="2" fill="#c68642"/>
        </svg>
        <button id="continueSnakeBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueSnakeBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player chooses to go alone
    function showGoAloneScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('goAloneScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'goAloneScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Wow, you're brave and courteous.<br>
          Amina can stay and go to school today!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You will earn <span style='color:#2E9DF7;'>double Journey Points</span> for this step.
        </div>
        <img src="img/water-can.png" alt="Water container" style="max-width:80px; height:auto; margin-bottom:16px;">
        <button id="continueGoAloneBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueGoAloneBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player waits for the snake to leave
    function showSnakeWaitCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('snakeWaitCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'snakeWaitCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You wait quietly and the snake finally slithers away.<br>
          This was a safe choice, but it took a long time and you lost some time on your journey.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>2 Journey Points</span> because you had to wait.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple snake illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <path d="M20 50 Q45 20 70 50" stroke="#159A48" stroke-width="6" fill="none"/>
        </svg>
        <button id="continueSnakeWaitBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueSnakeWaitBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Subtract 2 Journey Points for waiting
        score = score - 2;
        // Call the callback to continue the journey
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Add a simple cut scene for getting lost in the brush
    function showLostInBrushCutScene() {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('lostInBrushCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'lostInBrushCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You get lost in the thick brush and can't find your way back.<br>
          You are too tired to continue.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple lost in brush illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="30" cy="40" rx="10" ry="14" fill="#159A48" opacity="0.7"/>
          <ellipse cx="60" cy="40" rx="10" ry="14" fill="#159A48" opacity="0.7"/>
          <ellipse cx="45" cy="45" rx="12" ry="10" fill="#4FCB53" opacity="0.5"/>
        </svg>
        <button id="continueLostBrushBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, end the game for real
      document.getElementById('continueLostBrushBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Set energy to 0 so the ending message is clear
        energy = 0;
        // Call endGame() to stop the game and show the ending
        endGame();
      };
    }

    // Show a cut scene for 'Rest for a moment' at the muddy patch
   
    // This function is called when the player chooses to rest in the mud
    function showMuddyPatchRestCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('muddyPatchRestCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'muddyPatchRestCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You rest for a moment and catch your breath.<br>
          You feel a little better and gain 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0  90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="45" cy="40" rx="15" ry="10" fill="#8BD1CB" opacity="0.7"/>
          <ellipse cx="45" cy="45" rx="12" ry="8" fill="#4FCB53" opacity="0.5"/>
        </svg>
        <button id="continueMuddyRestBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueMuddyRestBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Show a cut scene for 'Push through' at the muddy patch
    // This function is called when the player chooses to push through the mud
    function showMuddyPatchPushThroughCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('muddyPatchPushThroughCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'muddyPatchPushThroughCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You push through the mud and keep going.<br>
          It's hard work and you lose 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="45" cy="45" rx="18" ry="7" fill="#8d5524" opacity="0.7"/>
          <ellipse cx="45" cy="48" rx="12" ry="5" fill="#F5402C" opacity="0.5"/>
        </svg>
        <button id="continueMuddyPushBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueMuddyPushBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Show a cut scene for the wild dog event
    function showWildDogCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('wildDogCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'wildDogCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You throw a stick into the brush and run past the wild dog, yelling.<br>
          That was scary! You lose 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="60" cy="45" rx="10" ry="6" fill="#8d5524"/>
          <ellipse cx="60" cy="40" rx="7" ry="4" fill="#c68642"/>
          <ellipse cx="65" cy="38" rx="2" ry="2" fill="#fff"/>
          <ellipse cx="55" cy="38" rx="2" ry="2" fill="#fff"/>
          <ellipse cx="60" cy="48" rx="4" ry="2" fill="#F5402C" opacity="0.5"/>
          <rect x="30" y="48" width="18" height="3" rx="1.5" fill="#8d5524"/>
        </svg>
        <button id="continueWildDogBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueWildDogBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Add the dirty water cut scene function
    function showDirtyWaterCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('dirtyWaterCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'dirtyWaterCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You fill your container, but the water is full of bugs and dirt.<br>
          You have to pour it all out. What a waste of time and energy!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span>.
        </div>
        <img src="img/clean and dirty water cups.jpg" alt="Clean vs dirty water" style="max-width:200px; height:auto; margin-bottom:16px; border-radius:8px; border:2px solid #FFC907;">
        <button id="continueDirtyWaterBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueDirtyWaterBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }
  </script>

  <!-- Footer with charity: water credit -->
  <footer role="contentinfo" style="position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #2E9DF7, #FFC907); color: #fff; text-align: center; padding: 8px 10px; font-size: 0.9em; font-weight: bold; box-shadow: 0 -2px 4px rgba(0,0,0,0.1); z-index: 1000;">
    Inspired by <a href="https://www.charitywater.org/" target="_blank" rel="noopener" style="color: #fff; text-decoration: underline;" aria-label="Visit charity: water website to learn more and donate">charity: water</a> 💧
  </footer>
</body>
</html>
