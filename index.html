<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Responsive viewport for mobile and tablet -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Long Walk: A Journey for Water</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      color: #111;
      font-weight: bold;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    #gameContainer {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      position: relative;
      overflow: hidden;
      /* We'll set background images from JavaScript */
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s;
      color: #111; /* Ensure text is very dark on white */
      font-weight: bold; /* Bolder text */
      padding-bottom: 0; /* Remove extra space at bottom */
    }

    h1 {
      color: #00263a; /* Even darker blue for better contrast */
      font-size: 2rem;
      text-align: center;
      font-weight: bold;
      letter-spacing: 1px;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }

    #storyText {
      font-size: 1.2rem;
      margin: 20px 0;
      color: #111; /* Very dark text */
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
      background: rgba(255,255,255,0.85); /* Light background for readability */
      border-radius: 6px;
      padding: 10px 12px;
      box-sizing: border-box;
    }

    #choices {
      display: flex; /* Use flexbox to center options */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin: 0 auto;
    }

    .choiceBtn {
      display: block;
      background-color: #005073;
      color: #fff;
      border: none;
      padding: 12px;
      margin: 10px 0;
      width: 100%;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      letter-spacing: 0.5px;
      transition: background 0.2s, color 0.2s;
      box-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
      margin-left: auto;
      margin-right: auto;
    }

    .choiceBtn:focus {
      outline: 3px solid #FFC907;
      outline-offset: 2px;
    }

    .choiceBtn:hover {
      background-color: #0077b6;
      color: #fff;
    }

    #statusBar {
      margin-top: 20px;
      font-size: 1rem;
      color: #111;
      background: rgba(255,255,255,0.85);
      padding: 8px 0;
      border-radius: 5px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }

    /* Character styles */
    #characterContainer {
      position: absolute; /* Place the character exactly over the map line */
      margin-bottom: 0;
      left: 0; /* Will be set by JS */
      top: 0;  /* Will be set by JS */
      width: 40px;
      height: 75px;
      pointer-events: none;
      z-index: 10; /* Above the SVG path */
      transition: left 0.7s, top 0.7s;
    }
    #characterSprite {
      width: 100%;
      height: auto;
      display: block;
    }
    #jerryCanIcon {
      position: absolute;
      right: 8px;
      bottom: 18px;
      width: 26px;
      height: 26px;
      z-index: 3;
    }

    /* Landing page overlay styles */
    #landingPage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #fff; /* Solid white for best contrast */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      color: #111;
      font-weight: bold;
    }
    #landingTitle {
      font-size: 2.2rem;
      color: #00263a;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
      margin-bottom: 10px;
      text-align: center;
      font-weight: bold;
    }
    #landingSubtitle {
      font-size: 1.1rem;
      color: #111;
      margin-bottom: 30px;
      text-align: center;
      max-width: 400px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }
    .landingBtn {
      background-color: #005073;
      color: #fff;
      border: none;
      padding: 14px 32px;
      margin: 10px;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
      letter-spacing: 0.5px;
      box-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }
    .landingBtn:focus {
      outline: 3px solid #FFC907;
      outline-offset: 2px;
    }
    .landingBtn:hover {
      background-color: #0077b6;
      color: #fff;
    }
    .landingBtn[style*="background-color:#FFC907"] {
      color: #222 !important; /* Ensure readable text on yellow */
    }
    .landingBtn[style*="background-color:#FFC907"]:hover {
      background-color: #e6b800 !important;
      color: #222 !important;
    }
    a:focus {
      outline: 3px solid #FFC907;
      outline-offset: 2px;
    }
    #didYouKnow {
      background: #FFFBEA;
      border-left: 6px solid #FFC907;
      color: #111;
      font-size: 1rem;
      margin: 16px 0 0 0;
      padding: 12px 18px 12px 14px;
      border-radius: 6px;
      box-shadow: 0 2px 8px #0001, 1px 1px 2px #fff;
      max-width: 500px;
      display: none;
      transition: opacity 0.5s;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }
    #didYouKnow a {
      color: #2E9DF7;
      text-decoration: underline;
      font-size: 0.98em;
      font-weight: bold;
    }
    #progressPath {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 10px auto;
      user-select: none;
      font-weight: bold;
      position: relative; /* Needed for absolute positioning of the character */
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.85);
      padding-bottom: 8px;
      z-index: 5;
    }
    #pathSVG {
      display: block;
      margin: 0 auto;
      background: none;
    }
    #milestoneLabels span {
      min-width: 40px;
      text-align: center;
      color: #111;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, 0 0 2px #fff;
    }

    /* Make SVGs and overlays responsive */
    #characterContainer, #characterSprite {
      max-width: 100vw;
      max-height: 25vh;
      width: 40px;
      height: 75px;
    }
    #progressPath, #pathSVG {
      width: 100%;
      max-width: 600px;
      min-width: 180px;
    }
    .choiceBtn, .landingBtn {
      font-size: 1rem;
      padding: 12px;
      width: 100%;
      max-width: 350px;
      box-sizing: border-box;
    }
    /* Responsive overlay for cut scenes and directions */
    #directionsCutScene, #schoolEndingScene, #glassCutScene, #wellCelebrationScene {
      max-width: 100vw;
      max-height: 100vh;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }
    /* Responsive text and layout for small screens */
    @media (max-width: 600px) {
      #gameContainer {
        padding: 8px;
        max-width: 98vw;
      }
      h1 {
        font-size: 1.1rem;
      }
      #scoreArea, #statusBar, #storyText {
        font-size: 1em;
        padding: 6px 4px;
      }
      .choiceBtn, .landingBtn {
        font-size: 0.95rem;
        padding: 10px;
      }
      #characterContainer, #characterSprite {
        width: 28px;
        height: 52px;
      }
      #progressPath, #pathSVG {
        min-width: 120px;
      }
      #milestoneLabels {
        font-size: 0.6em;
      }
    }
  </style>
</head>
<body>
  <!-- Landing Page Overlay -->
  <div id="landingPage" role="dialog" aria-modal="true" aria-labelledby="landingTitle" aria-describedby="landingSubtitle">
    <div id="landingTitle" tabindex="0">ðŸ’§ The Long Walk: A Charity: Water Journey</div>
    <div id="landingSubtitle" tabindex="0">
      Every day, millions of girls walk miles for clean water.<br>
      Can you help her reach a brighter future?<br>
      <span style="color:#005073; font-weight:bold;">Play to experience her journey.</span>
    </div>
    <button class="landingBtn" id="startGameBtn" aria-label="Start Game">Start Game</button>
    <a href="https://www.charitywater.org/" target="_blank" rel="noopener" aria-label="Learn more about Charity: Water">
      <button class="landingBtn" style="background-color:#FFC907; color:#222;">Learn More</button>
    </a>
  </div>

  <div id="gameContainer">
    <h1>The Long Walk: A Journey for Water</h1>
    <!-- Reset button for player control -->
    <button id="resetBtn" class="choiceBtn" style="max-width:200px; margin: 0 auto 10px auto; background-color:#F5402C;">Reset</button>
    <!-- Add a clear score area at the top -->
    <div id="scoreArea" style="text-align:center; font-size:1.1em; color:#2E9DF7; margin-bottom:8px;">
      Journey Points: <span id="scoreValue">10</span>
    </div>
    <!-- Progress path directly under the character's feet -->
    <div id="progressPath">
      <!-- Place the character icon absolutely over the SVG path -->
      <div id="characterContainer">
        <!-- Simple SVG: African girl with a rounder body and a green dress -->
        <svg id="characterSprite" viewBox="0 0 64 120" width="40" height="75" xmlns="http://www.w3.org/2000/svg">
          <!-- Hair: long, flowing, covers head and part of shoulders -->
          <path d="M32 12 Q10 40 20 90 Q32 115 44 90 Q54 40 32 12" fill="#3e2723"/>
          <!-- Head (tan skin) -->
          <ellipse cx="32" cy="28" rx="13" ry="15" fill="#c68642"/>
          <!-- Face: eyes, smile -->
          <ellipse cx="27" cy="28" rx="2" ry="2.5" fill="#222"/>
          <ellipse cx="37" cy="28" rx="2" ry="2.5" fill="#222"/>
          <path d="M28 36 Q32 40 36 36" stroke="#6d4c24" stroke-width="2" fill="none"/>
          <!-- Neck (single, simple, natural) -->
          <rect x="29" y="40" width="6" height="10" rx="3" fill="#c68642"/>
          <!-- Body: rounder torso (ellipse) -->
          <ellipse cx="32" cy="65" rx="15" ry="20" fill="#4FCB53"/>
          <!-- Dress (green, flared, overlays torso for skirt) -->
          <path d="M17 75 Q32 120 47 75 Q47 110 17 75" fill="#4FCB53"/>
          <!-- Dress belt -->
          <rect x="22" y="80" width="20" height="6" rx="3" fill="#FFC907" opacity="0.7"/>
          <!-- Left Arm (holding canister) -->
          <rect x="7" y="52" width="10" height="28" rx="5" fill="#c68642" transform="rotate(-18 12 66)"/>
          <!-- Right Arm (swinging) -->
          <rect x="47" y="52" width="10" height="28" rx="5" fill="#c68642" transform="rotate(18 52 66)"/>
          <!-- Left Leg -->
          <rect x="26" y="105" width="6" height="13" rx="3" fill="#8d5524"/>
          <!-- Right Leg -->
          <rect x="32" y="105" width="6" height="13" rx="3" fill="#8d5524"/>
          <!-- Canister (yellow, held in left hand) -->
          <rect x="2" y="75" width="14" height="18" rx="3" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
          <rect x="7" y="71" width="4" height="7" rx="1" fill="#bfa100"/>
          <!-- Canister handle -->
          <rect x="5" y="73" width="8" height="3" rx="1.5" fill="#bfa100"/>
          <!-- Hair details (bangs) -->
          <ellipse cx="32" cy="20" rx="10" ry="6" fill="#3e2723"/>
        </svg>
      </div>
      <svg id="pathSVG" width="100%" height="60" viewBox="0 0 400 60" style="max-width: 100%; min-width: 200px;">
        <!-- Winding path (brown) - only to river -->
        <path d="M 40 50 Q 120 10 200 40 Q 280 70 350 30" stroke="#8d5524" stroke-width="10" fill="none" stroke-linecap="round"/>
        <!-- Milestones (4 steps) -->
        <circle cx="40"  cy="50" r="13" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
        <circle cx="140" cy="20" r="11" fill="#FF902A" stroke="#F5402C" stroke-width="2"/>
        <circle cx="220" cy="45" r="11" fill="#8BD1CB" stroke="#159A48" stroke-width="2"/>
        <circle cx="350" cy="30" r="13" fill="#2E9DF7" stroke="#005073" stroke-width="3"/>
        <!-- Girl marker (moves along path) -->
        <circle id="girlMarker" cx="40" cy="50" r="12" fill="#c68642" stroke="#3e2723" stroke-width="2"/>
        <!-- Girl icon on the marker (simple head and dress) -->
        <g id="girlMiniIcon">
          <ellipse cx="40" cy="45" rx="4" ry="5" fill="#c68642"/>
          <ellipse cx="40" cy="55" rx="5" ry="7" fill="#4FCB53"/>
          <ellipse cx="40" cy="40" rx="5" ry="3" fill="#3e2723"/>
        </g>
        <!-- Simple SVG trees and rocks for jungle/forest feel -->
        <ellipse cx="100" cy="10" rx="8" ry="4" fill="#159A48"/>
        <rect x="95" y="5" width="4" height="8" fill="#8d5524"/>
        <ellipse cx="250" cy="60" rx="10" ry="5" fill="#159A48"/>
        <rect x="245" y="55" width="4" height="8" fill="#8d5524"/>
        <ellipse cx="400" cy="10" rx="7" ry="3" fill="#159A48"/>
        <rect x="397" y="7" width="3" height="6" fill="#8d5524"/>
        <ellipse cx="550" cy="55" rx="8" ry="4" fill="#159A48"/>
        <rect x="547" y="51" width="3" height="7" fill="#8d5524"/>
        <!-- Rocks -->
        <ellipse cx="180" cy="55" rx="5" ry="2" fill="#bfa77a"/>
        <ellipse cx="620" cy="40" rx="6" ry="3" fill="#bfa77a"/>
      </svg>
      <!-- Milestone labels for the new map (forward only) -->
      <div id="milestoneLabels" style="display: flex; justify-content: space-between; font-size: 0.7em; color: #555; margin-top: 16px; margin-bottom: 4px;">
        <span>start</span>
        <span>obstacle</span>
        <span>stale water</span>
        <span>river (turn back)</span>
      </div>
    </div>
    <div id="storyText">Click "Start" to begin the journey.</div>
    <div id="didYouKnow" style="display:none;">
      <!-- Did You Know box will be filled by JS -->
    </div>
    <div id="choices"></div>
    <div id="statusBar"></div>
    <!-- Audio elements for ambient and SFX -->
    <audio id="ambientWind" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b5b3b2e2.mp3" loop></audio>
    <audio id="ambientFootsteps" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e7.mp3" loop></audio>
    <audio id="ambientSchoolBell" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3"></audio>
    <audio id="sfxClick" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3"></audio>
    <audio id="sfxVictory" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3"></audio>
    <audio id="sfxLoss" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b6e7e7e.mp3"></audio>
  </div>

  <script>
    let currentStep = 0;
    let energy = 4; // Start Energy at 4
    let score = 0; // Start Journey Points at 0
    let lastScore = 0; // Track last score for feedback
    let wentAlone = false; // Track if player chose 'Go alone'
    let returning = false; // Track if player is returning home

    const storyText = document.getElementById('storyText');
    const choicesContainer = document.getElementById('choices');
    const statusBar = document.getElementById('statusBar');

    // Shorter story: only 8 steps, matching the map and milestones
    const storySteps = [
      {
        text: "You wake up early. Your family's only water source is 3 miles away. What do you do?",
        choices: [
          { text: "Go to school", effect: () => {}, next: null, endMessage: "You went to school, but your family is limited tonight on what they can eat and drink. Education is important, but so is water. Maybe next time you can help both!" },
          { text: "Grab the yellow jerry can and start on your trail", effect: () => {}, next: 1 }
        ]
      },
      {
        text: "You meet your friend Amina at the edge of the village. She offers to walk with you. What do you do?",
        choices: [
          { text: "Walk together", effect: () => { wentAlone = false; }, next: 2 },
          { text: "Go alone", effect: () => { window.doublePointsThisStep = true; wentAlone = true; }, next: 2 }
        ]
      },
      {
        text: "Thereâ€™s broken glass ahead. What do you do?",
        choices: [
          { text: "Step carefully around it", effect: () => {}, next: 3 },
          { text: "Run through it quickly", effect: () => {}, next: 3, glassCutScene: true },
          { text: "Ask Amina for help", effect: () => { window.broomCutScene = true; }, next: 3 }
        ]
      },
      {
        text: "A snake is coiled in the path. What do you do?",
        choices: [
          { text: "Walk around slowly", effect: () => { window.snakeWalkAroundCutScene = true; }, next: 4 },
          { text: "Throw a rock at it", effect: () => { energy--; }, next: 4 },
          { text: "Wait for it to leave", effect: () => { energy = energy - 1; window.skipJourneyPointsThisStep = true; window.snakeWaitCutScene = true; }, next: 4 }
        ]
      },
      {
        text: "You reach a muddy patch. What do you do?",
        choices: [
          { text: "Rest for a moment", effect: () => { energy = energy + 2; window.muddyPatchRestCutScene = true; }, next: 5 },
          { text: "Push through", effect: () => { energy = energy - 2; window.muddyPatchPushThroughCutScene = true; }, next: 5 },
          { text: "Try to find another way around", effect: () => { showLostInBrushCutScene(); }, next: null }
        ]
      },
      {
        text: "You see a wild dog in the road. What do you do?",
        choices: [
          // If you stand your ground, just continue to the next step
          { text: "Stand your ground. Ignore the dog and keep walking past it.", effect: () => {}, next: 6 },
          // If you distract the dog, set the flag for the cut scene (do not advance step here)
          { text: "Distract the dog by tossing something into the brush, then run past it yelling.", effect: () => { window.wildDogCutScene = true; }, next: null }
        ]
      },
      {
        text: "You finally reach the river. The water looks dirty. What do you do?",
        choices: [
          // Show a cut scene if you fill your container anyway
          { text: "Fill your container anyway", effect: () => { window.dirtyWaterCutScene = true; }, next: null },
          { text: "Walk further to a cleaner spot", effect: () => {}, next: 7 }
        ]
      },
      {
        text: "You made it to the water! Time to head home.",
        choices: [
          { text: "Finish the journey", effect: () => {}, next: null }
        ]
      }
    ];

    // Array of background images for each scene
    // (You can replace these URLs with your own or other free images)
    const backgroundImages = [
      // Morning sunrise
      "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",
      // Dry, cracked trails
      "https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=600&q=80",
      // Thorny brush or broken-glass paths
      "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=600&q=80",
      // A small village
      "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=600&q=80",
      // Vibrant well with children
      "https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=600&q=80"
    ];

    // Function to set the background image for the current step
    function setBackground(step) {
      // Get the game container element
      const gameContainer = document.getElementById('gameContainer');
      // If step is valid, set the background image
      if (backgroundImages[step]) {
        gameContainer.style.backgroundImage = `url('${backgroundImages[step]}')`;
      } else {
        // Default background if step is out of range
        gameContainer.style.backgroundImage = '';
      }
    }

    // Update the map SVG and milestone labels to stop at the river, then return
    const journeyPositions = [
      {cx:40, cy:50},    // Start
      {cx:140, cy:20},  // Obstacle
      {cx:220, cy:45},  // Stale Water
      {cx:350, cy:30}   // River (turn back)
    ];

    // Map each story step to a milestone index on the map
    // 0 = start, 1 = obstacle, 2 = stale water, 3 = river
    // The icon only moves when a key scene is reached
    // Only 8 steps for the short game. Each number matches a milestone on the map.
    const stepToMilestone = [
      0, // Step 0: start
      0, // Step 1: still at start
      1, // Step 2: obstacle (broken glass)
      1, // Step 3: still at obstacle (shortcut/thorns)
      1, // Step 4: still at obstacle (snake)
      1, // Step 5: still at obstacle (muddy patch)
      2, // Step 6: stale water (boys playing soccer)
      3  // Step 7: river (clean water scene)
    ];

    // Move the character to the correct milestone for the current story step
    function moveCharacter(step) {
      // Use the mapping to get the milestone index
      let idx = stepToMilestone[step] || 0;
      if (returning) {
        idx = 3 - idx; // Reverse the index for return
      }
      const character = document.getElementById('characterContainer');
      const pathSVG = document.getElementById('pathSVG');
      const svgRect = pathSVG.getBoundingClientRect();
      const scaleX = svgRect.width / 400;
      const scaleY = svgRect.height / 60;
      const left = journeyPositions[idx].cx * scaleX - character.offsetWidth / 2;
      const top = journeyPositions[idx].cy * scaleY - character.offsetHeight + 30; // 30px offset to align feet
      // Set the position
      character.style.left = `${left}px`;
      character.style.top = `${top}px`;
    }

    // Update the marker on the SVG path to match the story step
    function updatePathMarker(step) {
      let idx = stepToMilestone[step] || 0;
      if (returning) {
        idx = 3 - idx;
      }
      const marker = document.getElementById('girlMarker');
      const miniIcon = document.getElementById('girlMiniIcon');
      marker.setAttribute('cx', journeyPositions[idx].cx);
      marker.setAttribute('cy', journeyPositions[idx].cy);
      // Move the mini icon group to match the marker
      miniIcon.setAttribute('transform', `translate(${journeyPositions[idx].cx - 40},${journeyPositions[idx].cy - 50})`);
    }

    // Get audio elements
    const ambientWind = document.getElementById('ambientWind');
    const ambientFootsteps = document.getElementById('ambientFootsteps');
    const ambientSchoolBell = document.getElementById('ambientSchoolBell');
    const sfxClick = document.getElementById('sfxClick');
    const sfxVictory = document.getElementById('sfxVictory');
    const sfxLoss = document.getElementById('sfxLoss');

    // Helper to play a sound from the start
    function playSound(audio) {
      audio.currentTime = 0;
      audio.play();
    }

    // Show a directions cut scene at the start of the game (now with two screens)
    function showDirectionsCutScene() {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('directionsCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'directionsCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // First screen: introduction
      overlay.innerHTML = `
        <div id="directionsIntro" style="font-size:1.2em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:420px;">
          <span style="font-size:1.4em;">Welcome to The Long Walk: A Journey for Water</span><br><br>
          This story is based on the true journeys of girls in countries like Ethiopia, Uganda, and India.<br><br>
          Today, you will follow <span style='color:#4FCB53;'>Amina</span> as she walks miles to collect water for her family.<br><br>
          <span style='color:#F5402C;'>Your choices will affect what happens to Amina and her village.</span><br><br>
        </div>
        <button id="nextDirectionsBtn" class="choiceBtn" style="max-width:220px; background-color:#2E9DF7;">Next</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When 'Next' is clicked, show the instructions screen
      document.getElementById('nextDirectionsBtn').onclick = function() {
        // Replace the content with instructions
        overlay.innerHTML = `
          <div id="directionsInstructions" style="font-size:1.1em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:420px;">
            <span style='color:#2E9DF7;'>Journey Points:</span> Make good choices to earn points. If you reach <b>10 Journey Points</b> by the end, the new well in the village will be working for everyone!<br><br>
            <span style='color:#159A48;'>Energy:</span> You start with <b>4 Energy</b>. If you lose all your energy, Amina must turn back and her family won't get water that day.<br><br>
            The more people play and help Amina, the more is donated to <a href='https://www.charitywater.org/' target='_blank' style='color:#2E9DF7;'>Charity: Water</a>.<br><br>
            <span style='color:#FFC907;'>Are you ready to help Amina on her journey?</span>
          </div>
          <button id="startJourneyBtn" class="choiceBtn" style="max-width:220px; background-color:#4FCB53;">Start Journey</button>
        `;
        // When 'Start Journey' is clicked, remove overlay and start the story
        document.getElementById('startJourneyBtn').onclick = function() {
          overlay.remove();
          showStep();
        };
      };
    }

    // Start ambient sounds when game starts
    function startGame() {
      currentStep = 0;
      energy = 4;
      score = 0; // Reset Journey Points to 0
      lastScore = 0;
      returning = false; // Reset return flag
      setBackground(currentStep);
      moveCharacter(currentStep);
      updatePathMarker(currentStep);
      choicesContainer.innerHTML = '';
      // Hide the well scene if it exists
      hideWellScene();
      ambientWind.volume = 0.3;
      ambientWind.play();
      ambientFootsteps.volume = 0.2;
      ambientFootsteps.play();
      // Show the directions cut scene first
      showDirectionsCutScene();
    }

    // Stop all ambient sounds
    function stopAmbient() {
      ambientWind.pause();
      ambientWind.currentTime = 0;
      ambientFootsteps.pause();
      ambientFootsteps.currentTime = 0;
      ambientSchoolBell.pause();
      ambientSchoolBell.currentTime = 0;
    }

    // Array of "Did You Know?" facts
    const didYouKnowFacts = [
      "1 in 10 people lack access to clean water.",
      "Girls in sub-Saharan Africa spend 4x more time fetching water than boys.",
      "Access to clean water means more time for school and play.",
      "Diseases from dirty water kill more people every year than all forms of violence, including war.",
      // New facts about charity: water
      "Charity: water has funded over 111,000 water projects around the world.",
      "Thanks to charity: water, more than 15 million people now have clean water.",
      "100% of public donations to charity: water go directly to clean water projects.",
      "Charity: water works in 29 countries to help people get safe water.",
      "Clean water from charity: water projects helps kids spend more time in school.",
      "Learn more inspiring stories at <a href='https://www.charitywater.org/stories' target='_blank'>charitywater.org/stories</a>."
    ];

    // Show a random Did You Know box after each decision
    function showDidYouKnow() {
      const box = document.getElementById('didYouKnow');
      // Pick a random fact except the last one (save last for ending)
      const factIndex = Math.floor(Math.random() * (didYouKnowFacts.length - 1));
      box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[factIndex]}`;
      box.style.display = 'block';
      box.style.opacity = '1';
      // Show the fact for 15 seconds (was 5 seconds)
      setTimeout(() => {
        box.style.opacity = '0';
        setTimeout(() => { box.style.display = 'none'; }, 500);
      }, 15000); // 15000 ms = 15 seconds
    }

    function updateScoreDisplay() {
      const scoreValue = document.getElementById('scoreValue');
      if (!scoreValue) return;
      scoreValue.textContent = score;
      // Show feedback if score changed
      if (score !== lastScore) {
        const diff = score - lastScore;
        const feedback = document.createElement('span');
        feedback.textContent = diff > 0 ? ` +${diff}` : ` ${diff}`;
        feedback.style.color = diff > 0 ? "#4FCB53" : "#F5402C";
        feedback.style.fontWeight = "bold";
        feedback.style.marginLeft = "8px";
        scoreValue.parentElement.appendChild(feedback);
        setTimeout(() => feedback.remove(), 1200);
        lastScore = score;
      }
    }

    // Helper function to check if energy is 0 or less and end the game
    function checkGameOver() {
      // If energy is 0 or less, show the Game Over cut scene right away
      if (energy <= 0) {
        showGameOverCutScene();
        return true; // Game is over
      }
      return false; // Game continues
    }

    // In showStep, always add 2 journey points per step, or 4 if double points
    function showStep() {
      // Check for the muddy patch rest cut scene FIRST
      if (window.muddyPatchRestCutScene) {
        showMuddyPatchRestCutScene(() => {
          window.muddyPatchRestCutScene = false;
          // After the cut scene, check if energy is 0 or less
          if (energy <= 0) {
            showGameOverCutScene();
            return;
          }
          // Go to the next step after muddy patch (step 5: boys playing soccer)
          currentStep = 5;
          showStep(); // Call showStep() to continue the game
          showDidYouKnow();
        });
        return;
      }
      // Check for the muddy patch push through cut scene FIRST
      if (window.muddyPatchPushThroughCutScene) {
        showMuddyPatchPushThroughCutScene(() => {
          window.muddyPatchPushThroughCutScene = false;
          // After the cut scene, check if energy is 0 or less
          if (energy <= 0) {
            showGameOverCutScene();
            return;
          }
          // Go to the next step after muddy patch (step 5: boys playing soccer)
          currentStep = 5;
          showStep(); // Call showStep() to continue the game
          showDidYouKnow();
        });
        return;
      }
      // Always check if energy is 0 or less before doing anything else
      // If so, show the Game Over cut scene and stop the game
      if (checkGameOver()) {
        return;
      }
      // Set the background for the current step
      setBackground(currentStep);
      // Move the character and marker to match the story's progress on the map
      moveCharacter(currentStep);
      updatePathMarker(currentStep);

      // If the game is over, show the ending
      if (
        currentStep >= storySteps.length ||
        energy <= 0 ||
        storySteps[currentStep].choices.every(choice => choice.next === null)
      ) {
        // If the ending is from a choice with a custom endMessage, show it
        const lastStep = storySteps[currentStep] || {};
        const chosen = lastStep.choices && lastStep.choices.find(c => c.next === null && c.endMessage);
        if (chosen && chosen.endMessage) {
          // Show a gentle overlay scene for the 'Go to school' ending
          showSchoolEndingScene(chosen.endMessage);
          // Stop the game here so it does not continue
          return;
        }
        endGame();
        return;
      }

      // Special logic: If player went alone, hide 'Ask Amina for help' in the glass step
      let step = storySteps[currentStep];
      let choicesToShow = step.choices;
      // If this is the glass step and player went alone, filter out the help option
      if (step.text.includes("broken glass") && wentAlone) {
        choicesToShow = step.choices.filter(choice => !choice.text.includes("Amina"));
      }
      storyText.textContent = step.text;
      storyText.focus();
      choicesContainer.innerHTML = '';

      // Show choices for this step
      choicesToShow.forEach((choice, idx) => {
        const btn = document.createElement('button');
        btn.classList.add('choiceBtn');
        btn.textContent = choice.text;
        btn.onclick = () => {
          playSound(sfxClick); // Play click sound
          // If this is the 'Go alone' choice, show the cut scene and double points
          if (step.text.includes("Amina") && choice.text.includes("Go alone")) {
            showGoAloneScene(() => {
              choice.effect(); // Set doublePointsThisStep and wentAlone
              // Always add 4 journey points for double points steps
              score += 4;
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          choice.effect();
          // --- Fix for wild dog cut scene: if the flag is set, show the cut scene and return immediately ---
          if (window.wildDogCutScene) {
            // After the wild dog cut scene, subtract 2 energy. If energy is now 0 or less, show game over. Otherwise, go to the next step.
            showWildDogCutScene(() => {
              window.wildDogCutScene = false;
              energy = energy - 2; // Lose 2 energy for running past the dog
              if (energy <= 0) {
                // If energy is 0 or less, show the game over cut scene
                showGameOverCutScene();
                return;
              }
              currentStep++; // Go to the next step
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // If this is the snake step and player throws a rock, show the snake bite scene and end the game
          if (step.text.includes("snake") && choice.text.includes("Throw a rock")) {
            showSnakeBiteScene(() => {
              energy = 0;
              endGame();
            });
            return;
          }
          // If this choice ends the game, show the overlay and stop
          if (choice.endMessage) {
            showSchoolEndingScene(choice.endMessage);
            return;
          }
          // If this choice triggers the glass cut scene, show it and stop
          if (choice.glassCutScene) {
            showGlassCutScene(() => {
              // Do NOT add journey points for this step, just move to next
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // If this choice triggers the broom cut scene, show it and stop
          if (window.broomCutScene) {
            showBroomCutScene(() => {
              // Always add 4 journey points for teamwork
              score += 4;
              energy = energy - 1; // Lose 1 energy for the effort
              window.broomCutScene = false;
              if (typeof choice.next === "number") {
                currentStep = choice.next;
              } else {
                currentStep++;
              }
              showStep();
              showDidYouKnow();
            });
            return;
          }
          // For all other steps, always add 2 journey points (unless this step is a penalty step)
          // Penalty steps are handled in their own cut scenes or effect functions
          // So here, just add 2 points for a normal step
          if (!window.skipJourneyPointsThisStep) {
            score += 2;
          } else {
            // If skipJourneyPointsThisStep is true, do not add journey points
            window.skipJourneyPointsThisStep = false; // Reset the flag for next step
          }
          if (typeof choice.next === "number") {
            currentStep = choice.next;
          } else {
            currentStep++;
          }
          showStep();
          showDidYouKnow();
        };
        choicesContainer.appendChild(btn);
      });

      updateStatus();
      updateScoreDisplay(); // Update score visually

      // Check for the snake wait cut scene
      if (window.snakeWaitCutScene) {
        // Show the cut scene and then continue
        showSnakeWaitCutScene(() => {
          window.snakeWaitCutScene = false;
          currentStep = 5;
          showStep();
          showDidYouKnow();
        });
        return;
      }

      // Check for the snake walk around cut scene
      if (window.snakeWalkAroundCutScene) {
        showSnakeWalkAroundCutScene(() => {
          window.snakeWalkAroundCutScene = false;
          currentStep = 5;
          showStep();
          showDidYouKnow();
        });
        return;
      }

      // Check for the wild dog cut scene
      if (window.wildDogCutScene) {
        // After the wild dog cut scene, subtract 2 energy. If energy is now 0 or less, show game over. Otherwise, go to the next step.
        showWildDogCutScene(() => {
          window.wildDogCutScene = false;
          energy = energy - 2; // Lose 2 energy for running past the dog
          if (energy <= 0) {
            // If energy is 0 or less, show the game over cut scene
            showGameOverCutScene();
            return;
          }
          currentStep++; // Go to the next step
          showStep();
          showDidYouKnow();
        });
        return;
      }

      // In showStep, after wild dog cut scene, check for dirty water cut scene
      if (window.dirtyWaterCutScene) {
        // After the dirty water cut scene, always go to the next step (currentStep++)
        showDirtyWaterCutScene(() => {
          window.dirtyWaterCutScene = false;
          energy = energy - 1; // Lose 1 energy
          currentStep++; // Go to the next step
          showStep();
          showDidYouKnow();
        });
        return;
      }
    }

    function updateStatus() {
      // Show only Energy and Journey Points in the status bar
      statusBar.textContent = `Energy: ${energy} | Journey Points: ${score}`;
    }

    function endGame() {
      choicesContainer.innerHTML = '';
      stopAmbient();

      // Beginner-friendly: You win if you have 10 or more Journey Points at the end
      if (currentStep === 7 && score >= 10) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        showWellCelebrationScene();
        storyText.innerHTML = "You made it! With clean water, your family is healthier and happier.";
        playSound(sfxVictory);
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
        storyText.focus();
        const restart = document.createElement('button');
        restart.classList.add('choiceBtn');
        restart.textContent = 'Restart';
        restart.onclick = startGame;
        choicesContainer.appendChild(restart);
        updateStatus();
        updateScoreDisplay();
        return;
      }
      // If you finished the journey but have less than 10 points, show restart scene
      if (currentStep === 7 && score < 10) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        storyText.innerHTML = "You finished, but you need 10 Journey Points to win. Try again!";
        playSound(sfxLoss);
        const restart = document.createElement('button');
        restart.classList.add('choiceBtn');
        restart.textContent = 'Restart';
        restart.onclick = startGame;
        choicesContainer.appendChild(restart);
        updateStatus();
        updateScoreDisplay();
        return;
      }
      // If energy is 0, show the Game Over cut scene
      if (energy <= 0) {
        updatePathMarker(currentStep);
        moveCharacter(currentStep);
        setBackground(currentStep);
        storyText.innerHTML = "You ran out of energy and couldn't continue. <br> Try again to learn how to stay safe.";
        playSound(sfxLoss);
        // Show last fact (link to stories)
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
      } else {
        updatePathMarker(6);
        moveCharacter(backgroundImages.length - 1);

        // Show a special well scene at the end
        showWellCelebrationScene();

        // Only show a simple ending message (removed schoolProgress logic)
        storyText.innerHTML = "You made it! With clean water, your family is healthier and happier.";
        playSound(sfxVictory);
        // Show last fact (link to stories)
        const box = document.getElementById('didYouKnow');
        box.innerHTML = `<strong>Did You Know?</strong> ${didYouKnowFacts[didYouKnowFacts.length - 1]}`;
        box.style.display = 'block';
        box.style.opacity = '1';
      }
      storyText.focus();
      const restart = document.createElement('button');
      restart.classList.add('choiceBtn');
      restart.textContent = 'Restart';
      restart.onclick = startGame;
      choicesContainer.appendChild(restart);
      updateStatus();
      updateScoreDisplay(); // Show final score
      // Show a summary message based on score
      const scoreArea = document.getElementById('scoreArea');
      if (scoreArea) {
        let msg = "";
        if (score >= 15) {
          msg = "Amazing! You made great choices and helped your family.";
        } else if (score >= 10) {
          msg = "Good job! You finished the journey safely.";
        } else {
          msg = "Try again to make safer and smarter choices!";
        }
        scoreArea.innerHTML = `Journey Points: <span id="scoreValue">${score}</span> <br><span style="color:#159A48;">${msg}</span>`;
      }
    }

    // Show a well celebration scene at the end of the game
    function showWellCelebrationScene() {
      // Remove any previous well scene if present
      let oldWell = document.getElementById('wellCelebrationScene');
      if (oldWell) oldWell.remove();

      // Create a new div for the well scene
      const wellDiv = document.createElement('div');
      wellDiv.id = 'wellCelebrationScene';
      wellDiv.style.position = 'absolute';
      wellDiv.style.left = '50%';
      wellDiv.style.top = '50%';
      wellDiv.style.transform = 'translate(-50%, -40%)';
      wellDiv.style.zIndex = '20';
      wellDiv.style.background = 'rgba(255,255,255,0.95)';
      wellDiv.style.borderRadius = '12px';
      wellDiv.style.boxShadow = '0 4px 24px #0002';
      wellDiv.style.padding = '18px 24px 12px 24px';
      wellDiv.style.textAlign = 'center';

      // SVG well and happy people
      wellDiv.innerHTML = `
        <svg width="180" height="120" viewBox="0 0 180 120">
          <!-- Well base -->
          <ellipse cx="90"
          <rect x="60" y="60" width="60" height="50" rx="12" fill="#bfa77a" stroke="#8d5524" stroke-width="2"/>
          <!-- Well water -->
          <ellipse cx="90" cy="90" rx="25" ry="8" fill="#2E9DF7" opacity="0.7"/>
          <!-- Well roof -->
          <rect x="55" y="45" width="70" height="15" rx="4" fill="#8BD1CB" stroke="#159A48" stroke-width="2"/>
          <!-- Well posts -->
          <rect x="68" y="62" width="8" height="38" fill="#8d5524"/>
          <rect x="104" y="62" width="8" height="38" fill="#8d5524"/>
          <!-- Rope and bucket -->
          <rect x="87" y="62" width="6" height="22" fill="#FFC907"/>
          <ellipse cx="90" cy="92" rx="7" ry="4" fill="#FFC907" stroke="#bfa100" stroke-width="1"/>
          <!-- Happy people (simple circles) -->
          <circle cx="40" cy="110" r="10" fill="#c68642"/>
          <circle cx="140" cy="110" r="10" fill="#c68642"/>
          <circle cx="25" cy="100" r="7" fill="#c68642"/>
          <circle cx="155" cy="100" r="7" fill="#c68642"/>
          <!-- Water splash for celebration -->
          <ellipse cx="90" cy="85" rx="15" ry="4" fill="#2E9DF7" opacity="0.5"/>
        </svg>
        <div style="color:#159A48; font-size:1.2em; font-weight:bold; margin-top:8px;">
          Thanks to Charity: Water, your village has a new well!<br>
          Now you don't have to walk so far for water.
        </div>
      `;
      document.getElementById('gameContainer').appendChild(wellDiv);
    }

    // Optionally hide the well scene if needed
    function hideWellScene() {
      let oldWell = document.getElementById('wellCelebrationScene');
      if (oldWell) oldWell.remove();
    }

    // Hide landing page and start game when Start Game is clicked
    document.getElementById('startGameBtn').onclick = function() {
      // Hide the landing page
      document.getElementById('landingPage').style.display = 'none';
      // Start the game
      startGame();
    };

    // Add event listener for the Reset button
    document.getElementById('resetBtn').onclick = function() {
      // Reset the game to the beginning
      startGame();
    };

    // Function to show a gentle overlay scene if the player chooses 'Go to school'
    function showSchoolEndingScene(message) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('schoolEndingScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'schoolEndingScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a gentle message and a Restart button
      overlay.innerHTML = `
        <div style="font-size:1.3em; color:#005073; font-weight:bold; margin-bottom:18px; max-width:400px;">
          ${message}
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:18px; max-width:400px;">
          Your family is proud of your learning, but tonight there is less water and food to share. <br> <span style='color:#FFC907;'>Clean water helps everyone thrive!</span>
        </div>
        <button id="restartSchoolBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Restart</button>
      `;
      // Add the overlay to the game container
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Restart button
      document.getElementById('restartSchoolBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        startGame(); // Restart the game
      };
    }

    // Show a simple cut scene if glass breaks off in her sandal
    function showGlassCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('glassCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'glassCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a gentle message, a simple SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Ouch! Some glass broke off in your sandal. You need to slow down and be careful.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span> and <span style='color:#2E9DF7;'>1 Journey Point</span>.
        </div>
        <svg width="80" height="60" viewBox="0 0 80 60" style="margin-bottom:16px;">
          <ellipse cx="40" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <rect x="30" y="30" width="20" height="12" rx="6" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
          <polygon points="40,38 44,44 36,44" fill="#F5402C" opacity="0.7"/>
          <rect x="38" y="44" width="4" height="8" rx="2" fill="#8d5524"/>
          <polyline points="42,44 44,48 40,50 36,48 38,44" fill="none" stroke="#6d4c24" stroke-width="2"/>
          <line x1="40" y1="44" x2="40" y2="50" stroke="#F5402C" stroke-width="2"/>
        </svg>
        <button id="continueGlassBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueGlassBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Always subtract 1 energy and 1 journey point for running through glass
        // This happens no matter if you go alone or with Amina
        energy = energy - 1;
        score = score - 1; // Always subtract exactly 1 Journey Point (not random)
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene for teamwork with Amina to sweep away the glass
    function showBroomCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('broomCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'broomCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add teamwork message, SVG, and Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You and Amina find some sticks and make brooms.<br>
          Working together, you sweep away the glass so it's safe to walk!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span> (it was hard work),<br>
          but you earn <span style='color:#2E9DF7;'>double Journey Points</span> for teamwork!
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Two stick brooms and some glass -->
          <rect x="20" y="40" width="6" height="18" rx="2" fill="#8d5524"/>
          <rect x="64" y="40" width="6" height="18" rx="2" fill="#8d5524"/>
          <ellipse cx="23" cy="58" rx="7" ry="4" fill="#FFC907"/>
          <ellipse cx="67" cy="58" rx="7" ry="4" fill="#FFC907"/>
          <polygon points="45,50 50,55 40,55" fill="#2E9DF7" opacity="0.5"/>
          <polygon points="55,52 60,57 50,57" fill="#2E9DF7" opacity="0.5"/>
        </svg>
        <button id="continueBroomBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueBroomBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player is bitten by a snake
    function showSnakeBiteScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('snakeBiteScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'snakeBiteScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Oh no! You stumble and the snake bites you.<br>
          You become ill and must return home without water.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          Your family will have to wait for water. Try again and be careful next time!
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple snake and bite illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <path d="M20 50 Q45 10 70 50" stroke="#159A48" stroke-width="6" fill="none"/>
          <circle cx="70" cy="50" r="6" fill="#159A48"/>
          <circle cx="72" cy="48" r="1.5" fill="#fff"/>
          <circle cx="68" cy="48" r="1.5" fill="#fff"/>
          <ellipse cx="70" cy="54" rx="2" ry="1" fill="#F5402C"/>
          <rect x="40" y="44" width="10" height="6" rx="2" fill="#c68642"/>
        </svg>
        <button id="continueSnakeBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueSnakeBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player chooses to go alone
    function showGoAloneScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('goAloneScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'goAloneScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          Wow, you're brave and courteous.<br>
          Amina can stay and go to school today!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You will earn <span style='color:#2E9DF7;'>double Journey Points</span> for this step.
        </div>
        <svg width="80" height="60" viewBox="0 0 80 60" style="margin-bottom:16px;">
          <ellipse cx="40" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <circle cx="30" cy="40" r="10" fill="#4FCB53"/>
          <circle cx="50" cy="40" r="10" fill="#FFC907"/>
          <text x="40" y="35" text-anchor="middle" font-size="12" fill="#005073" font-weight="bold">:)</text>
        </svg>
        <button id="continueGoAloneBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueGoAloneBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        if (typeof continueCallback === 'function') {
          continueCallback(); // Continue the journey
        }
      };
    }

    // Show a cut scene if the player waits for the snake to leave
    function showSnakeWaitCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('snakeWaitCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'snakeWaitCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '30';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You wait quietly and the snake finally slithers away.<br>
          This was a safe choice, but it took a long time and you lost some time on your journey.
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>2 Journey Points</span> because you had to wait.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple snake illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <path d="M20 50 Q45 20 70 50" stroke="#159A48" stroke-width="6" fill="none"/>
        </svg>
        <button id="continueSnakeWaitBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // Add event listener for the Continue button
      document.getElementById('continueSnakeWaitBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Subtract 2 Journey Points for waiting
        score = score - 2;
        // Call the callback to continue the journey
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Add a simple cut scene for getting lost in the brush
    function showLostInBrushCutScene() {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('lostInBrushCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'lostInBrushCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You get lost in the thick brush and can't find your way back.<br>
          You are too tired to continue.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <!-- Simple lost in brush illustration -->
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="30" cy="40" rx="10" ry="14" fill="#159A48" opacity="0.7"/>
          <ellipse cx="60" cy="40" rx="10" ry="14" fill="#159A48" opacity="0.7"/>
          <ellipse cx="45" cy="45" rx="12" ry="10" fill="#4FCB53" opacity="0.5"/>
        </svg>
        <button id="continueLostBrushBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, end the game for real
      document.getElementById('continueLostBrushBtn').onclick = function() {
        overlay.remove(); // Remove the overlay
        // Set energy to 0 so the ending message is clear
        energy = 0;
        // Call endGame() to stop the game and show the ending
        endGame();
      };
    }

    // Show a cut scene for 'Rest for a moment' at the muddy patch
   
    // This function is called when the player chooses to rest in the mud
    function showMuddyPatchRestCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('muddyPatchRestCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'muddyPatchRestCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#159A48; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You rest for a moment and catch your breath.<br>
          You feel a little better and gain 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0  90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="45" cy="40" rx="15" ry="10" fill="#8BD1CB" opacity="0.7"/>
          <ellipse cx="45" cy="45" rx="12" ry="8" fill="#4FCB53" opacity="0.5"/>
        </svg>
        <button id="continueMuddyRestBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueMuddyRestBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Show a cut scene for 'Push through' at the muddy patch
    // This function is called when the player chooses to push through the mud
    function showMuddyPatchPushThroughCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('muddyPatchPushThroughCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'muddyPatchPushThroughCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You push through the mud and keep going.<br>
          It's hard work and you lose 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="45" cy="45" rx="18" ry="7" fill="#8d5524" opacity="0.7"/>
          <ellipse cx="45" cy="48" rx="12" ry="5" fill="#F5402C" opacity="0.5"/>
        </svg>
        <button id="continueMuddyPushBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueMuddyPushBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Show a cut scene for the wild dog event
    function showWildDogCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('wildDogCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'wildDogCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You throw a stick into the brush and run past the wild dog, yelling.<br>
          That was scary! You lose 2 Energy.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <ellipse cx="60" cy="45" rx="10" ry="6" fill="#8d5524"/>
          <ellipse cx="60" cy="40" rx="7" ry="4" fill="#c68642"/>
          <ellipse cx="65" cy="38" rx="2" ry="2" fill="#fff"/>
          <ellipse cx="55" cy="38" rx="2" ry="2" fill="#fff"/>
          <ellipse cx="60" cy="48" rx="4" ry="2" fill="#F5402C" opacity="0.5"/>
          <rect x="30" y="48" width="18" height="3" rx="1.5" fill="#8d5524"/>
        </svg>
        <button id="continueWildDogBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueWildDogBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }

    // Add the dirty water cut scene function
    function showDirtyWaterCutScene(continueCallback) {
      // Remove any previous overlay if present
      let oldOverlay = document.getElementById('dirtyWaterCutScene');
      if (oldOverlay) oldOverlay.remove();

      // Create a new overlay div
      const overlay = document.createElement('div');
      overlay.id = 'dirtyWaterCutScene';
      overlay.style.position = 'absolute';
      overlay.style.left = '0';
      overlay.style.top = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(255,255,255,0.97)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '40';
      overlay.style.textAlign = 'center';

      // Add a message, SVG, and a Continue button
      overlay.innerHTML = `
        <div style="font-size:1.2em; color:#F5402C; font-weight:bold; margin-bottom:10px; max-width:400px;">
          You fill your container, but the water is full of bugs and dirt.<br>
          You have to pour it all out. What a waste of time and energy!
        </div>
        <div style="font-size:1em; color:#222; margin-bottom:12px; max-width:400px;">
          You lose <span style='color:#F5402C;'>1 Energy</span>.
        </div>
        <svg width="90" height="60" viewBox="0 0 90 60" style="margin-bottom:16px;">
          <ellipse cx="45" cy="50" rx="30" ry="8" fill="#bfa77a"/>
          <rect x="35" y="35" width="20" height="18" rx="5" fill="#FFC907" stroke="#bfa100" stroke-width="2"/>
          <ellipse cx="45" cy="45" rx="8" ry="4" fill="#2E9DF7" opacity="0.7"/>
          <circle cx="45" cy="45" r="2" fill="#159A48"/>
          <ellipse cx="50" cy="48" rx="1.5" ry="1" fill="#8d5524"/>
          <ellipse cx="40" cy="48" rx="1.5" ry="1" fill="#8d5524"/>
          <ellipse cx="45" cy="50" rx="2" ry="1" fill="#F5402C"/>
        </svg>
        <button id="continueDirtyWaterBtn" class="choiceBtn" style="max-width:200px; background-color:#2E9DF7;">Continue</button>
      `;
      document.getElementById('gameContainer').appendChild(overlay);

      // When the player clicks Continue, remove overlay and continue
      document.getElementById('continueDirtyWaterBtn').onclick = function() {
        overlay.remove();
        if (typeof continueCallback === 'function') {
          continueCallback();
        }
      };
    }
  </script>
</body>
</html>
